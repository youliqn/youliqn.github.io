import{$ as le,b as ut,g as ft,d as oe,e as H,f as Xe,o as ye,s as en,h as Re,D as Dn,i as bt,j as M,L as re,k as D,l as y,c as p,S as P,t as w,m as be,n as me,p as E,q as xe,r as ce,F as wt,u as xt,v as Oe,M as He,w as Rt,x as Bn,_ as Hn,y as tt,z as Nn,A as Vn}from"./index-329f7601.js";const dt=Symbol("store-raw"),pe=Symbol("store-node"),X=Symbol("store-has"),tn=Symbol("store-self");function nn(e){let t=e[le];if(!t&&(Object.defineProperty(e,le,{value:t=new Proxy(e,zn)}),!Array.isArray(e))){const n=Object.keys(e),s=Object.getOwnPropertyDescriptors(e);for(let r=0,i=n.length;r<i;r++){const o=n[r];s[o].get&&Object.defineProperty(e,o,{enumerable:s[o].enumerable,get:s[o].get.bind(t)})}}return t}function Ue(e){let t;return e!=null&&typeof e=="object"&&(e[le]||!(t=Object.getPrototypeOf(e))||t===Object.prototype||Array.isArray(e))}function Ee(e,t=new Set){let n,s,r,i;if(n=e!=null&&e[dt])return n;if(!Ue(e)||t.has(e))return e;if(Array.isArray(e)){Object.isFrozen(e)?e=e.slice(0):t.add(e);for(let o=0,l=e.length;o<l;o++)r=e[o],(s=Ee(r,t))!==r&&(e[o]=s)}else{Object.isFrozen(e)?e=Object.assign({},e):t.add(e);const o=Object.keys(e),l=Object.getOwnPropertyDescriptors(e);for(let a=0,c=o.length;a<c;a++)i=o[a],!l[i].get&&(r=e[i],(s=Ee(r,t))!==r&&(e[i]=s))}return e}function ze(e,t){let n=e[t];return n||Object.defineProperty(e,t,{value:n=Object.create(null)}),n}function Le(e,t,n){if(e[t])return e[t];const[s,r]=H(n,{equals:!1,internal:!0});return s.$=r,e[t]=s}function jn(e,t){const n=Reflect.getOwnPropertyDescriptor(e,t);return!n||n.get||!n.configurable||t===le||t===pe||(delete n.value,delete n.writable,n.get=()=>e[le][t]),n}function sn(e){ft()&&Le(ze(e,pe),tn)()}function Un(e){return sn(e),Reflect.ownKeys(e)}const zn={get(e,t,n){if(t===dt)return e;if(t===le)return n;if(t===ut)return sn(e),n;const s=ze(e,pe),r=s[t];let i=r?r():e[t];if(t===pe||t===X||t==="__proto__")return i;if(!r){const o=Object.getOwnPropertyDescriptor(e,t);ft()&&(typeof i!="function"||e.hasOwnProperty(t))&&!(o&&o.get)&&(i=Le(s,t,i)())}return Ue(i)?nn(i):i},has(e,t){return t===dt||t===le||t===ut||t===pe||t===X||t==="__proto__"?!0:(ft()&&Le(ze(e,X),t)(),t in e)},set(){return!0},deleteProperty(){return!0},ownKeys:Un,getOwnPropertyDescriptor:jn};function Ge(e,t,n,s=!1){if(!s&&e[t]===n)return;const r=e[t],i=e.length;n===void 0?(delete e[t],e[X]&&e[X][t]&&r!==void 0&&e[X][t].$()):(e[t]=n,e[X]&&e[X][t]&&r===void 0&&e[X][t].$());let o=ze(e,pe),l;if((l=Le(o,t,r))&&l.$(()=>n),Array.isArray(e)&&e.length!==i){for(let a=e.length;a<i;a++)(l=o[a])&&l.$();(l=Le(o,"length",i))&&l.$(e.length)}(l=o[tn])&&l.$()}function rn(e,t){const n=Object.keys(t);for(let s=0;s<n.length;s+=1){const r=n[s];Ge(e,r,t[r])}}function Gn(e,t){if(typeof t=="function"&&(t=t(e)),t=Ee(t),Array.isArray(t)){if(e===t)return;let n=0,s=t.length;for(;n<s;n++){const r=t[n];e[n]!==r&&Ge(e,n,r)}Ge(e,"length",s)}else rn(e,t)}function ke(e,t,n=[]){let s,r=e;if(t.length>1){s=t.shift();const o=typeof s,l=Array.isArray(e);if(Array.isArray(s)){for(let a=0;a<s.length;a++)ke(e,[s[a]].concat(t),n);return}else if(l&&o==="function"){for(let a=0;a<e.length;a++)s(e[a],a)&&ke(e,[a].concat(t),n);return}else if(l&&o==="object"){const{from:a=0,to:c=e.length-1,by:u=1}=s;for(let f=a;f<=c;f+=u)ke(e,[f].concat(t),n);return}else if(t.length>1){ke(e[s],t,[s].concat(n));return}r=e[s],n=[s].concat(n)}let i=t[0];typeof i=="function"&&(i=i(r,n),i===r)||s===void 0&&i==null||(i=Ee(i),s===void 0||Ue(r)&&Ue(i)&&!Array.isArray(i)?rn(r,i):Ge(e,s,i))}function on(...[e,t]){const n=Ee(e||{}),s=Array.isArray(n),r=nn(n);function i(...o){oe(()=>{s&&o.length===1?Gn(n,o[0]):ke(n,o)})}return[r,i]}var Zn=!!Dn,Wn=e=>e!=null,qn=e=>e.filter(Wn),Kn=e=>typeof e=="function"&&!e.length?e():e,Xn=e=>Array.isArray(e)?e:e?[e]:[],Jn=Zn?e=>Xe()?ye(e):e:ye;function Yn(e,t,n){if(en.context){const[s,r]=H(e,n);return Re(()=>r(()=>t())),[s,r]}return H(t(),n)}function Qn(e,t,n,s){const r=e.length,i=t.length;let o=0;if(!i){for(;o<r;o++)n(e[o]);return}if(!r){for(;o<i;o++)s(t[o]);return}for(;o<i&&t[o]===e[o];o++);let l,a;t=t.slice(o),e=e.slice(o);for(l of t)e.includes(l)||s(l);for(a of e)t.includes(a)||n(a)}function St(e,t,n,s){return e.addEventListener(t,n,s),Jn(e.removeEventListener.bind(e,t,n,s))}function es(e,t=Xe()){let n=0,s,r;return()=>(n++,ye(()=>{n--,queueMicrotask(()=>{!n&&r&&(r(),r=s=void 0)})}),r||bt(i=>s=e(r=i),t),s)}function ts(e){const t=Xe(),n=es(e,t);return()=>en.context?bt(e,t):n()}function ns(e,t){const n=new ResizeObserver(e);return ye(n.disconnect.bind(n)),{observe:s=>n.observe(s,t),unobserve:n.unobserve.bind(n)}}function ss(e,t,n){const s=new WeakMap,{observe:r,unobserve:i}=ns(o=>{for(const l of o){const{contentRect:a,target:c}=l,u=Math.round(a.width),f=Math.round(a.height),d=s.get(c);(!d||d.width!==u||d.height!==f)&&(t(a,c,l),s.set(c,{width:u,height:f}))}},n);M(o=>{const l=qn(Xn(Kn(e)));return Qn(l,o,r,i),l},[])}const Se={CLIENT_GLOBAL_SETTINGS:{APIKey:"",password:"",enterToSend:!0},CLIENT_SESSION_SETTINGS:{title:"",saveSession:!0,APITemperature:.6,continuousDialogue:!0,model:"gpt-3.5"},CLIENT_DEFAULT_MESSAGE:`Powered by OpenAI Vercel
- 如果本项目对你有所帮助，可以给小猫 [买点零食](https://cdn.jsdelivr.net/gh/ourongxing/chatgpt-vercel/assets/reward.gif)，但不接受任何付费功能请求。
- 本网站仅作为项目演示，不提供服务，请填入自己的 Key，长期使用请 [自行部署](https://github.com/ourongxing/chatgpt-vercel#%E9%83%A8%E7%BD%B2%E4%B8%80%E4%B8%AA%E4%BD%A0%E8%87%AA%E5%B7%B1%E7%9A%84-chatgpt-%E7%BD%91%E7%AB%99%E5%85%8D%E8%B4%B9)，简单成本低。
- 点击每条消息前的头像，可以锁定对话，作为角色设定。[查看更多使用技巧](https://github.com/ourongxing/chatgpt-vercel#使用技巧)。
- 现在支持多个对话，打开对话设置，点击新建对话。在输入框里输入 [[/]][[/]] 或者 [[空格]][[空格]] 可以切换对话，搜索历史消息。
- [[Shift]] + [[Enter]] 换行。开头输入 [[/]] 或者 [[空格]] 搜索 Prompt 预设。[[↑]] 可编辑最近一次提问。点击顶部名称滚动到顶部，点击输入框滚动到底部。
`,CLIENT_MAX_INPUT_TOKENS:{"gpt-3.5":16*1e3,"gpt-4":32*1e3},OPENAI_API_BASE_URL:"api.openai.com",OPENAI_API_KEY:"",TIMEOUT:3e4,PASSWORD:"",SEND_KEY:"",SEND_CHANNEL:9,NO_GFW:!1};var Ce=(e,t)=>{let n=!1,s,r;const i=(...l)=>{r=l,!n&&(n=!0,s=setTimeout(()=>{e(...r),n=!1},t))},o=()=>{clearTimeout(s),n=!1};return Xe()&&ye(o),Object.assign(i,{clear:o})};function vt(e){try{const t=localStorage.getItem(re.PREFIXSESSION+e);if(t)return JSON.parse(t)}catch(t){console.error("Error parsing session:",t)}}function ln(e,t){localStorage.setItem(re.PREFIXSESSION+e,JSON.stringify(t))}function rs(e){localStorage.removeItem(re.PREFIXSESSION+e)}function is(){const e=[];return Object.keys(localStorage).forEach(t=>{const n=t.replace(re.PREFIXSESSION,"");if(n!==t){const s=vt(n);s&&e.push(s)}}),e}async function Je(e){if(e)try{return await navigator.clipboard.writeText(e)}catch{const t=document.createElement("textarea"),n=document.activeElement;t.value=e,t.setAttribute("readonly",""),t.style.contain="strict",t.style.position="absolute",t.style.left="-9999px",t.style.fontSize="12pt";const s=document.getSelection(),r=s?s.rangeCount>0&&s.getRangeAt(0):null;document.body.appendChild(t),t.select(),t.selectionStart=0,t.selectionEnd=e.length,document.execCommand("copy"),document.body.removeChild(t),r&&(s.removeAllRanges(),s.addRange(r)),n&&n.focus()}}function an(){return/Mobi|Android|iPhone/i.test(navigator.userAgent)}function cn(e,t="YYYY-mm-dd HH:MM"){let n;const s={"Y+":e.getFullYear().toString(),"m+":(e.getMonth()+1).toString(),"d+":e.getDate().toString(),"H+":e.getHours().toString(),"M+":e.getMinutes().toString(),"S+":e.getSeconds().toString()};return Object.entries(s).forEach(([r,i])=>{n=new RegExp("("+r+")").exec(t),n&&(t=t.replace(n[1],n[1].length==1?i:i.padStart(n[1].length,"0")))}),t}const je=Ce(()=>{window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"})},250);function $t(){const e="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";let t="";for(let n=0;n<8;n++)t+=e[Math.floor(Math.random()*e.length)];return t}/** @license
 * fzf v0.5.2
 * Copyright (c) 2021 Ajit
 * Licensed under BSD 3-Clause
 */const _t={216:"O",223:"s",248:"o",273:"d",295:"h",305:"i",320:"l",322:"l",359:"t",383:"s",384:"b",385:"B",387:"b",390:"O",392:"c",393:"D",394:"D",396:"d",398:"E",400:"E",402:"f",403:"G",407:"I",409:"k",410:"l",412:"M",413:"N",414:"n",415:"O",421:"p",427:"t",429:"t",430:"T",434:"V",436:"y",438:"z",477:"e",485:"g",544:"N",545:"d",549:"z",564:"l",565:"n",566:"t",567:"j",570:"A",571:"C",572:"c",573:"L",574:"T",575:"s",576:"z",579:"B",580:"U",581:"V",582:"E",583:"e",584:"J",585:"j",586:"Q",587:"q",588:"R",589:"r",590:"Y",591:"y",592:"a",593:"a",595:"b",596:"o",597:"c",598:"d",599:"d",600:"e",603:"e",604:"e",605:"e",606:"e",607:"j",608:"g",609:"g",610:"G",613:"h",614:"h",616:"i",618:"I",619:"l",620:"l",621:"l",623:"m",624:"m",625:"m",626:"n",627:"n",628:"N",629:"o",633:"r",634:"r",635:"r",636:"r",637:"r",638:"r",639:"r",640:"R",641:"R",642:"s",647:"t",648:"t",649:"u",651:"v",652:"v",653:"w",654:"y",655:"Y",656:"z",657:"z",663:"c",665:"B",666:"e",667:"G",668:"H",669:"j",670:"k",671:"L",672:"q",686:"h",867:"a",868:"e",869:"i",870:"o",871:"u",872:"c",873:"d",874:"h",875:"m",876:"r",877:"t",878:"v",879:"x",7424:"A",7427:"B",7428:"C",7429:"D",7431:"E",7432:"e",7433:"i",7434:"J",7435:"K",7436:"L",7437:"M",7438:"N",7439:"O",7440:"O",7441:"o",7442:"o",7443:"o",7446:"o",7447:"o",7448:"P",7449:"R",7450:"R",7451:"T",7452:"U",7453:"u",7454:"u",7455:"m",7456:"V",7457:"W",7458:"Z",7522:"i",7523:"r",7524:"u",7525:"v",7834:"a",7835:"s",8305:"i",8341:"h",8342:"k",8343:"l",8344:"m",8345:"n",8346:"p",8347:"s",8348:"t",8580:"c"};for(let e="̀".codePointAt(0);e<="ͯ".codePointAt(0);++e){const t=String.fromCodePoint(e);for(const n of"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"){const r=(n+t).normalize().codePointAt(0);r>126&&(_t[r]=n)}}const nt={a:[7844,7863],e:[7870,7879],o:[7888,7907],u:[7912,7921]};for(const e of Object.keys(nt)){const t=e.toUpperCase();for(let n=nt[e][0];n<=nt[e][1];++n)_t[n]=n%2===0?t:e}function Fe(e){if(e<192||e>8580)return e;const t=_t[e];return t!==void 0?t.codePointAt(0):e}function ne(e,t){return e>t?e:t}const un=e=>e.split("").map(t=>t.codePointAt(0)),os=new Set(` \f
\r	\v  \u2028\u2029  　\uFEFF`.split("").map(e=>e.codePointAt(0)));for(let e=" ".codePointAt(0);e<=" ".codePointAt(0);e++)os.add(e);const we="".codePointAt(0),Ae="A".codePointAt(0),Te="Z".codePointAt(0),fn="a".codePointAt(0),dn="z".codePointAt(0),ls="0".codePointAt(0),as="9".codePointAt(0);function he(e,t,n){return n?e:t-e-1}const Ie=16,Ze=-3,Pe=-1,ae=Ie/2,cs=Ie/2,us=ae+Pe,gn=-(Ze+Pe),hn=2;function gt(e){return e?new Set:null}function _e(e,t,n){if(t!==null&&t.i16.length>e+n){const s=t.i16.subarray(e,e+n);return[e+n,s]}return[e,new Int16Array(n)]}function Ot(e,t,n){if(t!==null&&t.i32.length>e+n){const s=t.i32.subarray(e,e+n);return[e+n,s]}return[e,new Int32Array(n)]}function mn(e){return e>=fn&&e<=dn?1:e>=Ae&&e<=Te?2:e>=ls&&e<=as?4:0}function pn(e){const t=String.fromCodePoint(e);return t!==t.toUpperCase()?1:t!==t.toLowerCase()?2:t.match(/\p{Number}/gu)!==null?4:t.match(/\p{Letter}/gu)!==null?3:0}function We(e){return e<=we?mn(e):pn(e)}function kt(e,t){return e===0&&t!==0?ae:e===1&&t===2||e!==4&&t===4?us:t===0?cs:0}function fs(e,t){return t===0?ae:kt(We(e[t-1]),We(e[t]))}function ds(e,t,n,s){let r=e.slice(s),i=r.indexOf(n);if(i===0)return s;if(!t&&n>=fn&&n<=dn){i>0&&(r=r.slice(0,i));const o=r.indexOf(n-32);o>=0&&(i=o)}return i<0?-1:s+i}function Ft(e){for(const t of e)if(t>=128)return!1;return!0}function Et(e,t,n){if(!Ft(e))return 0;if(!Ft(t))return-1;let s=0,r=0;for(let i=0;i<t.length;i++){if(r=ds(e,n,t[i],r),r<0)return-1;i===0&&r>0&&(s=r-1),r++}return s}const gs=(e,t,n,s,r,i,o)=>{const l=r.length;if(l===0)return[{start:0,end:0,score:0},gt(i)];const a=s.length;if(o!==null&&a*l>o.i16.length)return yn(e,t,n,s,r,i);const c=Et(s,r,e);if(c<0)return[{start:-1,end:-1,score:0},null];let u=0,f=0,d=null,h=null,C=null,m=null;[u,d]=_e(u,o,a),[u,h]=_e(u,o,a),[u,C]=_e(u,o,a),[f,m]=Ot(f,o,l);const[,x]=Ot(f,o,a);for(let $=0;$<x.length;$++)x[$]=s[$];let g=0,S=0,_=0,b=0;const T=r[0];let O=r[0],v=0,Z=0,N=!1,W=x.subarray(c),De=d.subarray(c).subarray(0,W.length),Tt=h.subarray(c).subarray(0,W.length),Tn=C.subarray(c).subarray(0,W.length);for(let[$,k]of W.entries()){let L=null;k<=we?(L=mn(k),!e&&L===2&&(k+=32)):(L=pn(k),!e&&L===2&&(k=String.fromCodePoint(k).toLowerCase().codePointAt(0)),t&&(k=Fe(k))),W[$]=k;const B=kt(Z,L);if(Tn[$]=B,Z=L,k===O&&(_<l&&(m[_]=c+$,_++,O=r[Math.min(_,l-1)]),b=c+$),k===T){const V=Ie+B*hn;if(De[$]=V,Tt[$]=1,l===1&&(n&&V>g||!n&&V>=g)&&(g=V,S=c+$,n&&B===ae))break;N=!1}else N?De[$]=ne(v+Pe,0):De[$]=ne(v+Ze,0),Tt[$]=0,N=!0;v=De[$]}if(_!==l)return[{start:-1,end:-1,score:0},null];if(l===1){const $={start:S,end:S+1,score:g};if(!i)return[$,null];const k=new Set;return k.add(S),[$,k]}const G=m[0],q=b-G+1;let Q=null;[u,Q]=_e(u,o,q*l);{const $=d.subarray(G,b+1);for(const[k,L]of $.entries())Q[k]=L}let[,fe]=_e(u,o,q*l);{const $=h.subarray(G,b+1);for(const[k,L]of $.entries())fe[k]=L}const It=m.subarray(1),In=r.slice(1).slice(0,It.length);for(const[$,k]of It.entries()){let L=!1;const B=In[$],V=$+1,ee=V*q,j=x.subarray(k,b+1),Pt=C.subarray(k).subarray(0,j.length),Pn=fe.subarray(ee+k-G).subarray(0,j.length),Mn=fe.subarray(ee+k-G-1-q).subarray(0,j.length),Rn=Q.subarray(ee+k-G).subarray(0,j.length),On=Q.subarray(ee+k-G-1-q).subarray(0,j.length),et=Q.subarray(ee+k-G-1).subarray(0,j.length);et[0]=0;for(const[K,Fn]of j.entries()){const Mt=K+k;let de=0,ve=0,ge=0;if(L?ve=et[K]+Pe:ve=et[K]+Ze,B===Fn){de=On[K]+Ie;let $e=Pt[K];ge=Mn[K]+1,$e===ae?ge=1:ge>1&&($e=ne($e,ne(gn,C[Mt-ge+1]))),de+$e<ve?(de+=Pt[K],ge=0):de+=$e}Pn[K]=ge,L=de<ve;const Be=ne(ne(de,ve),0);V===l-1&&(n&&Be>g||!n&&Be>=g)&&(g=Be,S=Mt),Rn[K]=Be}}const Qe=gt(i);let ie=G;if(i&&Qe!==null){let $=l-1;ie=S;let k=!0;for(;;){const L=$*q,B=ie-G,V=Q[L+B];let ee=0,j=0;if($>0&&ie>=m[$]&&(ee=Q[L-q+B-1]),ie>m[$]&&(j=Q[L+B-1]),V>ee&&(V>j||V===j&&k)){if(Qe.add(ie),$===0)break;$--}k=fe[L+B]>1||L+q+B+1<fe.length&&fe[L+q+B+1]>0,ie--}}return[{start:ie,end:S+1,score:g},Qe]};function Cn(e,t,n,s,r,i,o){let l=0,a=0,c=!1,u=0,f=0;const d=gt(o);let h=0;r>0&&(h=We(n[r-1]));for(let C=r;C<i;C++){let m=n[C];const x=We(m);if(e||(m>=Ae&&m<=Te?m+=32:m>we&&(m=String.fromCodePoint(m).toLowerCase().codePointAt(0))),t&&(m=Fe(m)),m===s[l]){o&&d!==null&&d.add(C),a+=Ie;let g=kt(h,x);u===0?f=g:(g===ae&&(f=g),g=ne(ne(g,f),gn)),l===0?a+=g*hn:a+=g,c=!1,u++,l++}else c?a+=Pe:a+=Ze,c=!0,u=0,f=0;h=x}return[a,d]}const yn=(e,t,n,s,r,i,o)=>{if(r.length===0)return[{start:0,end:0,score:0},null];if(Et(s,r,e)<0)return[{start:-1,end:-1,score:0},null];let l=0,a=-1,c=-1;const u=s.length,f=r.length;for(let d=0;d<u;d++){let h=s[he(d,u,n)];e||(h>=Ae&&h<=Te?h+=32:h>we&&(h=String.fromCodePoint(h).toLowerCase().codePointAt(0))),t&&(h=Fe(h));const C=r[he(l,f,n)];if(h===C&&(a<0&&(a=d),l++,l===f)){c=d+1;break}}if(a>=0&&c>=0){l--;for(let C=c-1;C>=a;C--){const m=he(C,u,n);let x=s[m];e||(x>=Ae&&x<=Te?x+=32:x>we&&(x=String.fromCodePoint(x).toLowerCase().codePointAt(0)));const g=he(l,f,n),S=r[g];if(x===S&&(l--,l<0)){a=C;break}}if(!n){const C=a;a=u-c,c=u-C}const[d,h]=Cn(e,t,s,r,a,c,i);return[{start:a,end:c,score:d},h]}return[{start:-1,end:-1,score:0},null]},hs=(e,t,n,s,r,i,o)=>{if(r.length===0)return[{start:0,end:0,score:0},null];const l=s.length,a=r.length;if(l<a)return[{start:-1,end:-1,score:0},null];if(Et(s,r,e)<0)return[{start:-1,end:-1,score:0},null];let c=0,u=-1,f=0,d=-1;for(let h=0;h<l;h++){const C=he(h,l,n);let m=s[C];e||(m>=Ae&&m<=Te?m+=32:m>we&&(m=String.fromCodePoint(m).toLowerCase().codePointAt(0))),t&&(m=Fe(m));const x=he(c,a,n);if(r[x]===m){if(x===0&&(f=fs(s,C)),c++,c===a){if(f>d&&(u=h,d=f),f===ae)break;h-=c-1,c=0,f=0}}else h-=c,c=0,f=0}if(u>=0){let h=0,C=0;n?(h=u-a+1,C=u+1):(h=l-(u+1),C=l-(u-a+1));const[m]=Cn(e,t,s,r,h,C,!1);return[{start:h,end:C,score:m},null]}return[{start:-1,end:-1,score:0},null]},ms=100*1024,ps=2048;function Cs(e,t){return{i16:new Int16Array(e),i32:new Int32Array(t)}}const ys=Cs(ms,ps),bs=(e,t,n)=>{let s=!1;switch(t){case"smart-case":e.toLowerCase()!==e&&(s=!0);break;case"case-sensitive":s=!0;break;case"case-insensitive":e=e.toLowerCase(),s=!1;break}let r=un(e);return n&&(r=r.map(Fe)),{queryRunes:r,caseSensitive:s}};function ws(e,t){const n=Object.keys(e).map(r=>parseInt(r,10)).sort((r,i)=>i-r);let s=[];for(const r of n)if(s=s.concat(e[r]),s.length>=t)break;return s}function xs(e,t,n){return s=>{const r=this.runesList[s];if(t.length>r.length)return;let[i,o]=this.algoFn(n,this.opts.normalize,this.opts.forward,r,t,!0,ys);if(i.start===-1)return;if(this.opts.fuzzy===!1){o=new Set;for(let a=i.start;a<i.end;++a)o.add(a)}const l=this.opts.sort?i.score:0;e[l]===void 0&&(e[l]=[]),e[l].push({item:this.items[s],...i,positions:o??new Set})}}function Ss(e){const{queryRunes:t,caseSensitive:n}=bs(e,this.opts.casing,this.opts.normalize),s={},r=xs.bind(this)(s,t,n);for(let i=0,o=this.runesList.length;i<o;++i)r(i);return ws(s,this.opts.limit)}const bn={limit:1/0,selector:e=>e,casing:"smart-case",normalize:!0,fuzzy:"v2",tiebreakers:[],sort:!0,forward:!0};class vs{constructor(t,...n){switch(this.opts={...bn,...n[0]},this.items=t,this.runesList=t.map(s=>un(this.opts.selector(s).normalize())),this.algoFn=hs,this.opts.fuzzy){case"v2":this.algoFn=gs;break;case"v1":this.algoFn=yn;break}}}const $s={...bn,match:Ss};class _s extends vs{constructor(t,...n){super(t,...n),this.opts={...$s,...n[0]}}find(t){if(t.length===0||this.items.length===0)return this.items.slice(0,this.opts.limit).map(ks);t=t.normalize();let n=this.opts.match.bind(this)(t);return Es(n,this.opts)}}const ks=e=>({item:e,start:-1,end:-1,score:0,positions:new Set});function Es(e,t){if(t.sort){const{selector:n}=t;e.sort((s,r)=>{if(s.score===r.score)for(const i of t.tiebreakers){const o=i(s,r,n);if(o!==0)return o}return 0})}return Number.isFinite(t.limit)&&e.splice(t.limit),e}class wn{constructor(t,...n){this.finder=new _s(t,...n),this.find=this.finder.find.bind(this.finder)}}function Ls(){return new Worker("/assets/tokens.worker-94912c15.js")}function As(){return new Worker("/assets/markdown.worker-f15491c5.js")}const st=new Ls,rt=new As;function it(e){if(!e)return Promise.resolve(0);const t=$t();return st.postMessage({type:"token",id:t,payload:e}),new Promise(n=>{function s(r){r.data.type==="token-return"&&r.data.id===t&&(st.removeEventListener("message",s),n(r.data.payload))}st.addEventListener("message",s)})}function Dt(e){if(!e)return Promise.resolve("");const t=$t();return rt.postMessage({type:"markdown",id:t,payload:e}),new Promise(n=>{function s(r){r.data.type==="markdown-return"&&r.data.id===t&&(rt.removeEventListener("message",s),n(r.data.payload))}rt.addEventListener("message",s)})}let ht={...Se.CLIENT_GLOBAL_SETTINGS},J={}.CLIENT_GLOBAL_SETTINGS;if(J)try{ht={...ht,...JSON.parse(J)}}catch(e){console.error("Error parsing CLIENT_GLOBAL_SETTINGS:",e)}let mt={...Se.CLIENT_SESSION_SETTINGS};J={}.CLIENT_SESSION_SETTINGS;if(J)try{mt={...mt,...JSON.parse(J)}}catch(e){console.error("Error parsing CLIENT_SESSION_SETTINGS:",e)}let pt=Se.CLIENT_MAX_INPUT_TOKENS;J={}.CLIENT_MAX_INPUT_TOKENS;if(J)try{Number.isNaN(+J)&&(pt={...pt,...JSON.parse(J)})}catch(e){console.error("Error parsing CLIENT_MAX_INPUT_TOKENS:",e)}const Ts={role:"assistant",content:{}.CLIENT_DEFAULT_MESSAGE||Se.CLIENT_DEFAULT_MESSAGE,type:"default"},Bt={"gpt-3.5":{"4k":"gpt-3.5-turbo-0613","16k":"gpt-3.5-turbo-16k-0613"},"gpt-4":{"8k":"gpt-4-0613","32k":"gpt-4-32k-0613"}},Is={"gpt-3.5-turbo-0613":{input:.0015,output:.002},"gpt-3.5-turbo-16k-0613":{input:.003,output:.004},"gpt-4-0613":{input:.03,output:.06},"gpt-4-32k-0613":{input:.06,output:.12}};function Ps(){const[e,t]=on({sessionId:"index",globalSettings:ht,sessionSettings:mt,inputContent:"",messageList:[],currentAssistantMessage:"",contextToken:0,currentMessageToken:0,inputContentToken:0,loading:!1,inputRef:null,get validContext(){return n()},get contextToken$(){return c()},get currentMessageToken$(){return u()},get inputContentToken$(){return a()},get remainingToken(){return o()},get currentModel(){return l()}}),n=D(()=>e.sessionSettings.continuousDialogue?e.messageList.filter((f,d,h)=>f.role==="assistant"&&f.type!=="temporary"&&h[d-1]?.role==="user"||f.role==="user"&&h[d+1]?.role!=="error"&&h[d+1]?.type!=="temporary"):e.messageList.filter(f=>f.type==="locked")),s=Ce(f=>{it(f).then(d=>{t("inputContentToken",d)})},100);M(()=>{e.inputContent,s(e.inputContent)});const r=Ce(f=>{it(f).then(d=>{t("contextToken",d)})},100);M(()=>{e.validContext,r(e.validContext.map(f=>f.content).join(`
`))});const i=Ce(f=>{it(f).then(d=>{t("currentMessageToken",d)})},50);M(()=>{i(e.currentAssistantMessage)});const o=D(()=>(e.globalSettings.APIKey?pt[e.sessionSettings.model]:Se.CLIENT_MAX_INPUT_TOKENS[e.sessionSettings.model])-e.contextToken-e.inputContentToken),l=D(()=>{const f=e.sessionSettings.model,d=(e.inputContentToken+e.contextToken)/1e3;return f==="gpt-3.5"?Bt["gpt-3.5"][d<3.5?"4k":"16k"]:Bt["gpt-4"][d<7?"8k":"32k"]}),a=D(()=>ot(e.inputContentToken,e.currentModel,"input")),c=D(()=>ot(e.contextToken,e.currentModel,"input")),u=D(()=>ot(e.currentMessageToken,e.currentModel,"output"));return{store:e,setStore:t}}const ue=bt(Ps),z={promptOptions:[],fzfPrompts:void 0,sessionOptions:[],fzfSessions:void 0};function Me(e){const{store:t,setStore:n}=ue;oe(()=>{n("sessionId",e);try{const s=localStorage.getItem(re.GLOBALSETTINGS),r=vt(e);if(s){const i=JSON.parse(s);n("globalSettings",o=>({...o,...i}))}if(r){const{settings:i,messages:o}=r;i&&n("sessionSettings",l=>({...l,...i})),o&&(t.sessionSettings.saveSession?n("messageList",o):n("messageList",o.filter(l=>l.type==="locked")))}}catch{console.log("Localstorage parse error")}}),setTimeout(()=>{const s=is();z.sessionOptions=s.sort((r,i)=>i.lastVisit-r.lastVisit).filter(r=>r.id!==t.sessionId&&r.id!=="index").map(r=>({title:r.settings.title,desc:r.messages.map(i=>i.content).join(`
`),extra:{id:r.id}})),e!=="index"&&z.sessionOptions.unshift({title:"回到主对话",desc:"其实点击顶部 Logo 也可以直接回到主对话。"+s.find(r=>r.id==="index")?.messages.map(r=>r.content).join(`
`),extra:{id:"index"}}),z.fzfSessions=new wn(z.sessionOptions,{selector:r=>`${r.title}
${r.desc}`})},500)}function ot(e,t,n){const s=e/1e3;return Is[t][n]*s}function Ms(){const e=new Map;Re(()=>{St(window,"click",t=>{const n=t.target;if(n.matches(".copy")){const s=n.parentElement,r=n.nextElementSibling;if(!s||!r)return;const i=r.innerText;Je(i.trim()).then(()=>{n.classList.add("copied"),clearTimeout(e.get(n));const o=setTimeout(()=>{n.classList.remove("copied"),n.blur(),e.delete(n)},2e3);e.set(n,o)})}})})}function Rs(e,t){const n=s=>!e.contains(s.target)&&t()?.();document.body.addEventListener("click",n),ye(()=>document.body.removeEventListener("click",n))}const Os=w('<div class="flex absolute items-center justify-between <sm:top--4 <sm:right-0 top-2 right-2 text-sm text-slate-7 dark:text-slate group-hover:opacity-100 group-focus:opacity-100 opacity-0 dark:bg-#292B32 bg-#E7EBF0 rounded">'),Fs=w('<div class="flex items-center cursor-pointer p-2 hover:bg-slate/10 rounded text-1.2em"><button>');function Ds({role:e,edit:t,del:n,copy:s,reAnswer:r}){const[i,o]=H(!1);return(()=>{const l=Os();return y(l,p(P,{when:e==="assistant",get children(){return p(Ne,{label:"复制",onClick:()=>{o(!0),s(),setTimeout(()=>o(!1),1e3)},get icon(){return i()?"i-un:copied":"i-un:copy"}})}}),null),y(l,p(P,{when:e==="user",get children(){return p(Ne,{label:"编辑",onClick:t,icon:"i-carbon:edit"})}}),null),y(l,p(Ne,{label:"重新回答",onClick:r,icon:"i-carbon:reset"}),null),y(l,p(Ne,{label:"删除",onClick:n,icon:"i-carbon:trash-can"}),null),l})()}function Ne(e){return(()=>{const t=Fs(),n=t.firstChild;return be(t,"click",e.onClick,!0),me(t,"position","top"),E(s=>{const r=e.label,i=e.icon,o=e.label;return r!==s._v$&&me(t,"tooltip",s._v$=r),i!==s._v$2&&xe(n,s._v$2=i),o!==s._v$3&&me(n,"title",s._v$3=o),s},{_v$:void 0,_v$2:void 0,_v$3:void 0}),t})()}ce(["click"]);const Bs=`<svg width="79" height="21" viewBox="0 0 79 21" fill="none" xmlns="http://www.w3.org/2000/svg" style="display:inline">
<path d="M19.3326 8.59688C19.5951 7.875 19.6607 7.15313 19.5951 6.43125C19.5295 5.70938 19.267 4.9875 18.9389 4.33125C18.3482 3.34687 17.4951 2.55938 16.5107 2.1C15.4607 1.64063 14.3451 1.50938 13.2295 1.77188C12.7045 1.24688 12.1139 0.7875 11.4576 0.459375C10.8014 0.13125 10.0139 0 9.29199 0C8.17636 0 7.06074 0.328125 6.14199 0.984375C5.22324 1.64062 4.56699 2.55937 4.23886 3.60938C3.45136 3.80625 2.79512 4.13438 2.13887 4.52813C1.54824 4.9875 1.08887 5.57812 0.695115 6.16875C0.10449 7.15312 -0.0923848 8.26875 0.0388652 9.38438C0.170115 10.5 0.62949 11.55 1.35137 12.4031C1.08887 13.125 1.02324 13.8469 1.08887 14.5688C1.15449 15.2906 1.41699 16.0125 1.74512 16.6687C2.33574 17.6531 3.18887 18.4406 4.17324 18.9C5.22324 19.3594 6.33887 19.4906 7.45449 19.2281C7.97949 19.7531 8.57012 20.2125 9.22637 20.5406C9.88262 20.8687 10.6701 21 11.392 21C12.5076 21 13.6232 20.6719 14.542 20.0156C15.4607 19.3594 16.117 18.4406 16.4451 17.3906C17.167 17.2594 17.8889 16.9313 18.4795 16.4719C19.0701 16.0125 19.5951 15.4875 19.9232 14.8313C20.5139 13.8469 20.7107 12.7313 20.5795 11.6156C20.4482 10.5 20.0545 9.45 19.3326 8.59688ZM11.4576 19.6219C10.4076 19.6219 9.62012 19.2937 8.89824 18.7031C8.89824 18.7031 8.96387 18.6375 9.02949 18.6375L13.2295 16.2094C13.3607 16.1438 13.4264 16.0781 13.492 15.9469C13.5576 15.8156 13.5576 15.75 13.5576 15.6187V9.7125L15.3295 10.7625V15.6187C15.3951 17.9156 13.5576 19.6219 11.4576 19.6219ZM2.99199 16.0125C2.53262 15.225 2.33574 14.3062 2.53262 13.3875C2.53262 13.3875 2.59824 13.4531 2.66387 13.4531L6.86386 15.8813C6.99511 15.9469 7.06074 15.9469 7.19199 15.9469C7.32324 15.9469 7.45449 15.9469 7.52011 15.8813L12.6389 12.9281V14.9625L8.37324 17.4563C7.45449 17.9813 6.40449 18.1125 5.42012 17.85C4.37012 17.5875 3.51699 16.9312 2.99199 16.0125ZM1.87637 6.89062C2.33574 6.10312 3.05761 5.5125 3.91074 5.18438V5.31563V10.1719C3.91074 10.3031 3.91074 10.4344 3.97637 10.5C4.04199 10.6313 4.10761 10.6969 4.23886 10.7625L9.35762 13.7156L7.58574 14.7656L3.38574 12.3375C2.46699 11.8125 1.81074 10.9594 1.54824 9.975C1.28574 8.99062 1.35137 7.80937 1.87637 6.89062ZM16.3795 10.2375L11.2607 7.28438L13.0326 6.23438L17.2326 8.6625C17.8889 9.05625 18.4139 9.58125 18.742 10.2375C19.0701 10.8938 19.267 11.6156 19.2014 12.4031C19.1357 13.125 18.8732 13.8469 18.4139 14.4375C17.9545 15.0281 17.3639 15.4875 16.642 15.75V10.7625C16.642 10.6312 16.642 10.5 16.5764 10.4344C16.5764 10.4344 16.5107 10.3031 16.3795 10.2375ZM18.1514 7.6125C18.1514 7.6125 18.0857 7.54688 18.0201 7.54688L13.8201 5.11875C13.6889 5.05313 13.6232 5.05312 13.492 5.05312C13.3607 5.05312 13.2295 5.05313 13.1639 5.11875L8.04512 8.07188V6.0375L12.3107 3.54375C12.967 3.15 13.6889 3.01875 14.4764 3.01875C15.1982 3.01875 15.9201 3.28125 16.5764 3.74062C17.167 4.2 17.692 4.79063 17.9545 5.44688C18.217 6.10313 18.2826 6.89063 18.1514 7.6125ZM7.12637 11.2875L5.35449 10.2375V5.31563C5.35449 4.59375 5.55137 3.80625 5.94512 3.21563C6.33887 2.55938 6.92949 2.1 7.58574 1.77188C8.24199 1.44375 9.02949 1.3125 9.75137 1.44375C10.4732 1.50938 11.1951 1.8375 11.7857 2.29688C11.7857 2.29688 11.7201 2.3625 11.6545 2.3625L7.45449 4.79063C7.32324 4.85625 7.25761 4.92187 7.19199 5.05312C7.12636 5.18437 7.12637 5.25 7.12637 5.38125V11.2875ZM8.04512 9.1875L10.342 7.875L12.6389 9.1875V11.8125L10.342 13.125L8.04512 11.8125V9.1875Z" fill="currentColor"/>
<path d="M34.2931 10.5455C34.2931 11.7102 34.08 12.7116 33.6539 13.5497C33.2277 14.3842 32.6436 15.027 31.9014 15.478C31.1627 15.9254 30.3229 16.1491 29.3818 16.1491C28.4372 16.1491 27.5938 15.9254 26.8517 15.478C26.113 15.027 25.5306 14.3825 25.1045 13.5444C24.6784 12.7063 24.4653 11.7067 24.4653 10.5455C24.4653 9.38068 24.6784 8.38104 25.1045 7.54652C25.5306 6.70845 26.113 6.0657 26.8517 5.61825C27.5938 5.16726 28.4372 4.94176 29.3818 4.94176C30.3229 4.94176 31.1627 5.16726 31.9014 5.61825C32.6436 6.0657 33.2277 6.70845 33.6539 7.54652C34.08 8.38104 34.2931 9.38068 34.2931 10.5455ZM32.6631 10.5455C32.6631 9.65767 32.5193 8.91016 32.2316 8.30291C31.9475 7.69212 31.5569 7.23047 31.0598 6.91797C30.5661 6.60192 30.0068 6.44389 29.3818 6.44389C28.7533 6.44389 28.1922 6.60192 27.6986 6.91797C27.205 7.23047 26.8144 7.69212 26.5267 8.30291C26.2426 8.91016 26.1006 9.65767 26.1006 10.5455C26.1006 11.4332 26.2426 12.1825 26.5267 12.7933C26.8144 13.4006 27.205 13.8622 27.6986 14.1783C28.1922 14.4908 28.7533 14.647 29.3818 14.647C30.0068 14.647 30.5661 14.4908 31.0598 14.1783C31.5569 13.8622 31.9475 13.4006 32.2316 12.7933C32.5193 12.1825 32.6631 11.4332 32.6631 10.5455ZM36.2173 19.0682V7.81818H37.7727V9.14453H37.9059C37.9982 8.97408 38.1314 8.77699 38.3054 8.55327C38.4794 8.32955 38.7209 8.13423 39.0298 7.96733C39.3388 7.79688 39.7472 7.71165 40.255 7.71165C40.9155 7.71165 41.505 7.87855 42.0234 8.21236C42.5419 8.54616 42.9485 9.02734 43.2433 9.65589C43.5416 10.2844 43.6907 11.0408 43.6907 11.9251C43.6907 12.8093 43.5433 13.5675 43.2486 14.1996C42.9538 14.8281 42.549 15.3129 42.0341 15.6538C41.5192 15.9911 40.9315 16.1598 40.271 16.1598C39.7738 16.1598 39.3672 16.0763 39.0511 15.9094C38.7386 15.7425 38.4936 15.5472 38.3161 15.3235C38.1385 15.0998 38.0018 14.9009 37.9059 14.7269H37.81V19.0682H36.2173ZM37.7781 11.9091C37.7781 12.4844 37.8615 12.9886 38.0284 13.4219C38.1953 13.8551 38.4368 14.1942 38.7528 14.4393C39.0689 14.6808 39.456 14.8015 39.9141 14.8015C40.3899 14.8015 40.7876 14.6754 41.1072 14.4233C41.4269 14.1676 41.6683 13.8214 41.8317 13.3846C41.9986 12.9478 42.082 12.456 42.082 11.9091C42.082 11.3693 42.0004 10.8846 41.837 10.4549C41.6772 10.0252 41.4357 9.68608 41.1126 9.4375C40.793 9.18892 40.3935 9.06463 39.9141 9.06463C39.4524 9.06463 39.0618 9.18359 38.7422 9.42152C38.4261 9.65945 38.1864 9.99148 38.0231 10.4176C37.8597 10.8437 37.7781 11.3409 37.7781 11.9091ZM49.0014 16.1651C48.1953 16.1651 47.5011 15.9929 46.9187 15.6484C46.3398 15.3004 45.8924 14.8121 45.5764 14.1836C45.2639 13.5515 45.1076 12.8111 45.1076 11.9624C45.1076 11.1243 45.2639 10.3857 45.5764 9.74645C45.8924 9.10724 46.3327 8.60831 46.8974 8.24964C47.4656 7.89098 48.1296 7.71165 48.8896 7.71165C49.3512 7.71165 49.7987 7.788 50.2319 7.9407C50.6651 8.09339 51.054 8.3331 51.3984 8.6598C51.7429 8.98651 52.0146 9.41087 52.2134 9.93288C52.4123 10.4513 52.5117 11.0817 52.5117 11.8239V12.3885H46.0078V11.1953H50.951C50.951 10.7763 50.8658 10.4052 50.6953 10.082C50.5249 9.75533 50.2852 9.49787 49.9762 9.30966C49.6708 9.12145 49.3122 9.02734 48.9002 9.02734C48.4528 9.02734 48.0622 9.13743 47.7283 9.3576C47.3981 9.57422 47.1424 9.85831 46.9613 10.2099C46.7837 10.5579 46.695 10.9361 46.695 11.3445V12.2766C46.695 12.8235 46.7908 13.2887 46.9826 13.6722C47.1779 14.0558 47.4496 14.3487 47.7976 14.5511C48.1456 14.75 48.5522 14.8494 49.0174 14.8494C49.3193 14.8494 49.5945 14.8068 49.843 14.7216C50.0916 14.6328 50.3065 14.5014 50.4876 14.3274C50.6687 14.1534 50.8072 13.9386 50.9031 13.6829L52.4105 13.9545C52.2898 14.3984 52.0732 14.7873 51.7607 15.1211C51.4517 15.4513 51.0629 15.7088 50.5941 15.8935C50.1289 16.0746 49.598 16.1651 49.0014 16.1651ZM55.8715 11.142V16H54.2789V7.81818H55.8076V9.14986H55.9088C56.097 8.71662 56.3918 8.36861 56.7931 8.10582C57.1979 7.84304 57.7075 7.71165 58.3218 7.71165C58.8794 7.71165 59.3676 7.82884 59.7867 8.06321C60.2057 8.29403 60.5306 8.63849 60.7615 9.09659C60.9923 9.55469 61.1077 10.1211 61.1077 10.7958V16H59.515V10.9876C59.515 10.3945 59.3605 9.93111 59.0516 9.5973C58.7426 9.25994 58.3183 9.09126 57.7785 9.09126C57.4092 9.09126 57.0807 9.17116 56.7931 9.33097C56.509 9.49077 56.2835 9.72514 56.1166 10.0341C55.9532 10.3395 55.8715 10.7088 55.8715 11.142ZM64.2931 16H62.5459L66.4717 5.09091H68.3733L72.2991 16H70.5519L67.4678 7.07244H67.3826L64.2931 16ZM64.586 11.728H70.2536V13.1129H64.586V11.728ZM75.5204 5.09091V16H73.8745V5.09091H75.5204Z" fill="currentColor"/>
</svg>
`,Hs=`<svg width="74" height="21" viewBox="0 0 74 21" fill="none" xmlns="http://www.w3.org/2000/svg" style="display:inline">
<path d="M11.4999 0.5L23 20.5H0L11.4999 0.5Z" fill="currentColor"/>
<path d="M28.152 5.09091L31.1882 13.9759H31.3107L34.3469 5.09091H36.1261L32.2003 16H30.2987L26.3729 5.09091H28.152ZM40.2796 16.1651C39.4735 16.1651 38.7792 15.9929 38.1968 15.6484C37.618 15.3004 37.1705 14.8121 36.8545 14.1836C36.542 13.5515 36.3857 12.8111 36.3857 11.9624C36.3857 11.1243 36.542 10.3857 36.8545 9.74645C37.1705 9.10724 37.6109 8.60831 38.1755 8.24964C38.7437 7.89098 39.4078 7.71165 40.1677 7.71165C40.6294 7.71165 41.0768 7.788 41.51 7.9407C41.9433 8.09339 42.3321 8.3331 42.6766 8.6598C43.021 8.98651 43.2927 9.41087 43.4916 9.93288C43.6904 10.4513 43.7899 11.0817 43.7899 11.8239V12.3885H37.286V11.1953H42.2291C42.2291 10.7763 42.1439 10.4052 41.9735 10.082C41.803 9.75533 41.5633 9.49787 41.2544 9.30966C40.949 9.12145 40.5903 9.02734 40.1784 9.02734C39.7309 9.02734 39.3403 9.13743 39.0065 9.3576C38.6762 9.57422 38.4205 9.85831 38.2394 10.2099C38.0619 10.5579 37.9731 10.9361 37.9731 11.3445V12.2766C37.9731 12.8235 38.069 13.2887 38.2607 13.6722C38.4561 14.0558 38.7277 14.3487 39.0757 14.5511C39.4237 14.75 39.8303 14.8494 40.2955 14.8494C40.5974 14.8494 40.8726 14.8068 41.1212 14.7216C41.3698 14.6328 41.5846 14.5014 41.7657 14.3274C41.9468 14.1534 42.0853 13.9386 42.1812 13.6829L43.6887 13.9545C43.5679 14.3984 43.3513 14.7873 43.0388 15.1211C42.7298 15.4513 42.341 15.7088 41.8722 15.8935C41.407 16.0746 40.8762 16.1651 40.2796 16.1651ZM45.557 16V7.81818H47.0964V9.1179H47.1816C47.3308 8.67756 47.5936 8.33132 47.97 8.07919C48.35 7.82351 48.7797 7.69567 49.2591 7.69567C49.3585 7.69567 49.4757 7.69922 49.6106 7.70632C49.7491 7.71342 49.8574 7.7223 49.9355 7.73295V9.25639C49.8716 9.23864 49.758 9.21911 49.5946 9.1978C49.4313 9.17294 49.2679 9.16051 49.1046 9.16051C48.7282 9.16051 48.3926 9.24041 48.0978 9.40021C47.8066 9.55646 47.5758 9.77486 47.4054 10.0554C47.2349 10.3324 47.1497 10.6484 47.1497 11.0036V16H45.557ZM54.4672 16.1651C53.6753 16.1651 52.9935 15.9858 52.4218 15.6271C51.8536 15.2649 51.4168 14.766 51.1114 14.1303C50.806 13.4947 50.6533 12.7667 50.6533 11.9464C50.6533 11.1154 50.8096 10.3821 51.1221 9.74645C51.4346 9.10724 51.8749 8.60831 52.4431 8.24964C53.0113 7.89098 53.6807 7.71165 54.4513 7.71165C55.0727 7.71165 55.6267 7.82706 56.1132 8.05788C56.5997 8.28516 56.9921 8.60476 57.2904 9.01669C57.5922 9.42862 57.7716 9.9098 57.8284 10.4602H56.2783C56.1931 10.0767 55.9978 9.74645 55.6924 9.46946C55.3905 9.19247 54.9857 9.05398 54.4779 9.05398C54.034 9.05398 53.6452 9.17116 53.3113 9.40554C52.9811 9.63636 52.7236 9.96662 52.539 10.3963C52.3543 10.8224 52.262 11.3267 52.262 11.9091C52.262 12.5057 52.3525 13.0206 52.5336 13.4538C52.7148 13.8871 52.9704 14.2227 53.3007 14.4606C53.6345 14.6985 54.0269 14.8175 54.4779 14.8175C54.7797 14.8175 55.0532 14.7624 55.2982 14.6523C55.5468 14.5387 55.7545 14.3771 55.9214 14.1676C56.0919 13.9581 56.2108 13.706 56.2783 13.4112H57.8284C57.7716 13.9403 57.5993 14.4126 57.3117 14.8281C57.0241 15.2436 56.6388 15.5703 56.1558 15.8082C55.6764 16.0462 55.1135 16.1651 54.4672 16.1651ZM63.0579 16.1651C62.2518 16.1651 61.5575 15.9929 60.9751 15.6484C60.3963 15.3004 59.9489 14.8121 59.6328 14.1836C59.3203 13.5515 59.1641 12.8111 59.1641 11.9624C59.1641 11.1243 59.3203 10.3857 59.6328 9.74645C59.9489 9.10724 60.3892 8.60831 60.9538 8.24964C61.522 7.89098 62.1861 7.71165 62.946 7.71165C63.4077 7.71165 63.8551 7.788 64.2884 7.9407C64.7216 8.09339 65.1104 8.3331 65.4549 8.6598C65.7994 8.98651 66.071 9.41087 66.2699 9.93288C66.4688 10.4513 66.5682 11.0817 66.5682 11.8239V12.3885H60.0643V11.1953H65.0075C65.0075 10.7763 64.9222 10.4052 64.7518 10.082C64.5813 9.75533 64.3416 9.49787 64.0327 9.30966C63.7273 9.12145 63.3686 9.02734 62.9567 9.02734C62.5092 9.02734 62.1186 9.13743 61.7848 9.3576C61.4545 9.57422 61.1989 9.85831 61.0178 10.2099C60.8402 10.5579 60.7514 10.9361 60.7514 11.3445V12.2766C60.7514 12.8235 60.8473 13.2887 61.0391 13.6722C61.2344 14.0558 61.506 14.3487 61.854 14.5511C62.2021 14.75 62.6087 14.8494 63.0739 14.8494C63.3757 14.8494 63.6509 14.8068 63.8995 14.7216C64.1481 14.6328 64.3629 14.5014 64.544 14.3274C64.7251 14.1534 64.8636 13.9386 64.9595 13.6829L66.467 13.9545C66.3462 14.3984 66.1296 14.7873 65.8171 15.1211C65.5082 15.4513 65.1193 15.7088 64.6506 15.8935C64.1854 16.0746 63.6545 16.1651 63.0579 16.1651ZM69.928 5.09091V16H68.3353V5.09091H69.928Z" fill="currentColor"/>
</svg>
`,Ns=w('<div class="i-carbon:locked text-white">'),Vs=w('<div class="group flex gap-3 px-4 mx--4 rounded-lg transition-colors sm:hover:bg-slate/6 dark:sm:hover:bg-slate/5 relative message-item"><div></div><div class="message prose prose-slate dark:prose-invert dark:text-slate break-words overflow-hidden">');function Ht(e){Ms();const{store:t,setStore:n}=ue,[s,r]=H(""),i={error:"bg-gradient-to-r from-red-400 to-red-700",system:"bg-gradient-to-r from-gray-300 via-gray-200 to-gray-300",user:"bg-gradient-to-r from-red-300 to-blue-700 ",assistant:"bg-gradient-to-r from-yellow-300 to-red-700 "};function o(){Je(e.message.content)}function l(){n("inputContent",e.message.content)}function a(){n("messageList",d=>d[e.index].role==="user"?d.filter((h,C)=>!(C===e.index||C===e.index+1&&h.role!=="user")):d.filter((h,C)=>C!==e.index))}function c(){let d="";n("messageList",h=>h[e.index].role==="user"?(d=h[e.index].content,h.filter((C,m)=>!(m===e.index||m===e.index+1&&C.role!=="user"))):(d=h[e.index-1].content,h.filter((C,m)=>!(m===e.index||m===e.index-1)))),e.sendMessage?.(d)}function u(){e.index!==void 0&&(t.messageList[e.index].role==="user"?n("messageList",(d,h)=>h===e.index||h===e.index+1&&d.role==="assistant","type",d=>d==="locked"?void 0:"locked"):n("messageList",[e.index-1,e.index],"type",d=>d==="locked"?void 0:"locked"))}const f=Ce(d=>{Dt(d).then(h=>{r(h)})},50);return M(()=>{e.message.type==="temporary"?f(e.message.content):Dt(e.message.content).then(d=>{r(d)})}),p(P,{get when(){return s()},get children(){const d=Vs(),h=d.firstChild,C=h.nextSibling;return d.style.setProperty("transition","all 0.3s"),h.$$click=u,y(h,p(P,{get when(){return e.message.type==="locked"},get children(){return Ns()}})),y(d,p(P,{get when(){return!e.hiddenAction},get children(){return p(Ds,{del:a,copy:o,edit:l,reAnswer:c,get role(){return e.message.role}})}}),null),E(m=>{const x=e.message.type==="temporary",g=`shadow-slate-5 shadow-sm dark:shadow-none shrink-0 w-7 h-7 mt-4 rounded-full op-80 flex items-center justify-center cursor-pointer ${i[e.message.role]}`,S=e.message.type==="temporary",_=s().replace(/\s*Vercel\s*/g,`<a href="http://vercel.com/?utm_source=busiyi&utm_campaign=oss" style="border-bottom:0;margin-left: 6px">${Hs}</a>`).replace(/\s*OpenAI\s*/g,`<a href="https://www.openai.com" style="border-bottom:0;margin-left: 6px">${Bs}</a>`);return x!==m._v$&&d.classList.toggle("temporary",m._v$=x),g!==m._v$2&&xe(h,m._v$2=g),S!==m._v$3&&h.classList.toggle("animate-spin",m._v$3=S),_!==m._v$4&&(C.innerHTML=m._v$4=_),m},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0}),d}})}ce(["click"]);function js(e,t){if(e.match(/^[a-z]+:\/\//i))return e;if(e.match(/^\/\//))return window.location.protocol+e;if(e.match(/^[a-z]+:/i))return e;const n=document.implementation.createHTMLDocument(),s=n.createElement("base"),r=n.createElement("a");return n.head.appendChild(s),n.body.appendChild(r),t&&(s.href=t),r.href=e,r.href}const Us=(()=>{let e=0;const t=()=>`0000${(Math.random()*36**4<<0).toString(36)}`.slice(-4);return()=>(e+=1,`u${t()}${e}`)})();function Y(e){const t=[];for(let n=0,s=e.length;n<s;n++)t.push(e[n]);return t}function qe(e,t){const s=(e.ownerDocument.defaultView||window).getComputedStyle(e).getPropertyValue(t);return s?parseFloat(s.replace("px","")):0}function zs(e){const t=qe(e,"border-left-width"),n=qe(e,"border-right-width");return e.clientWidth+t+n}function Gs(e){const t=qe(e,"border-top-width"),n=qe(e,"border-bottom-width");return e.clientHeight+t+n}function xn(e,t={}){const n=t.width||zs(e),s=t.height||Gs(e);return{width:n,height:s}}function Zs(){let e,t;try{t=process}catch{}const n=t&&t.env?t.env.devicePixelRatio:null;return n&&(e=parseInt(n,10),Number.isNaN(e)&&(e=1)),e||window.devicePixelRatio||1}const F=16384;function Ws(e){(e.width>F||e.height>F)&&(e.width>F&&e.height>F?e.width>e.height?(e.height*=F/e.width,e.width=F):(e.width*=F/e.height,e.height=F):e.width>F?(e.height*=F/e.width,e.width=F):(e.width*=F/e.height,e.height=F))}function qs(e,t={}){return e.toBlob?new Promise(n=>{e.toBlob(n,t.type?t.type:"image/png",t.quality?t.quality:1)}):new Promise(n=>{const s=window.atob(e.toDataURL(t.type?t.type:void 0,t.quality?t.quality:void 0).split(",")[1]),r=s.length,i=new Uint8Array(r);for(let o=0;o<r;o+=1)i[o]=s.charCodeAt(o);n(new Blob([i],{type:t.type?t.type:"image/png"}))})}function Ke(e){return new Promise((t,n)=>{const s=new Image;s.decode=()=>t(s),s.onload=()=>t(s),s.onerror=n,s.crossOrigin="anonymous",s.decoding="async",s.src=e})}async function Ks(e){return Promise.resolve().then(()=>new XMLSerializer().serializeToString(e)).then(encodeURIComponent).then(t=>`data:image/svg+xml;charset=utf-8,${t}`)}async function Xs(e,t,n){const s="http://www.w3.org/2000/svg",r=document.createElementNS(s,"svg"),i=document.createElementNS(s,"foreignObject");return r.setAttribute("width",`${t}`),r.setAttribute("height",`${n}`),r.setAttribute("viewBox",`0 0 ${t} ${n}`),i.setAttribute("width","100%"),i.setAttribute("height","100%"),i.setAttribute("x","0"),i.setAttribute("y","0"),i.setAttribute("externalResourcesRequired","true"),r.appendChild(i),i.appendChild(e),Ks(r)}const R=(e,t)=>{if(e instanceof t)return!0;const n=Object.getPrototypeOf(e);return n===null?!1:n.constructor.name===t.name||R(n,t)};function Js(e){const t=e.getPropertyValue("content");return`${e.cssText} content: '${t.replace(/'|"/g,"")}';`}function Ys(e){return Y(e).map(t=>{const n=e.getPropertyValue(t),s=e.getPropertyPriority(t);return`${t}: ${n}${s?" !important":""};`}).join(" ")}function Qs(e,t,n){const s=`.${e}:${t}`,r=n.cssText?Js(n):Ys(n);return document.createTextNode(`${s}{${r}}`)}function Nt(e,t,n){const s=window.getComputedStyle(e,n),r=s.getPropertyValue("content");if(r===""||r==="none")return;const i=Us();try{t.className=`${t.className} ${i}`}catch{return}const o=document.createElement("style");o.appendChild(Qs(i,n,s)),t.appendChild(o)}function er(e,t){Nt(e,t,":before"),Nt(e,t,":after")}const Vt="application/font-woff",jt="image/jpeg",tr={woff:Vt,woff2:Vt,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:jt,jpeg:jt,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml",webp:"image/webp"};function nr(e){const t=/\.([^./]*?)$/g.exec(e);return t?t[1]:""}function Lt(e){const t=nr(e).toLowerCase();return tr[t]||""}function sr(e){return e.split(/,/)[1]}function Ct(e){return e.search(/^(data:)/)!==-1}function Sn(e,t){return`data:${t};base64,${e}`}async function vn(e,t,n){const s=await fetch(e,t);if(s.status===404)throw new Error(`Resource "${s.url}" not found`);const r=await s.blob();return new Promise((i,o)=>{const l=new FileReader;l.onerror=o,l.onloadend=()=>{try{i(n({res:s,result:l.result}))}catch(a){o(a)}},l.readAsDataURL(r)})}const lt={};function rr(e,t,n){let s=e.replace(/\?.*/,"");return n&&(s=e),/ttf|otf|eot|woff2?/i.test(s)&&(s=s.replace(/.*\//,"")),t?`[${t}]${s}`:s}async function At(e,t,n){const s=rr(e,t,n.includeQueryParams);if(lt[s]!=null)return lt[s];n.cacheBust&&(e+=(/\?/.test(e)?"&":"?")+new Date().getTime());let r;try{const i=await vn(e,n.fetchRequestInit,({res:o,result:l})=>(t||(t=o.headers.get("Content-Type")||""),sr(l)));r=Sn(i,t)}catch(i){r=n.imagePlaceholder||"";let o=`Failed to fetch resource: ${e}`;i&&(o=typeof i=="string"?i:i.message),o&&console.warn(o)}return lt[s]=r,r}async function ir(e){const t=e.toDataURL();return t==="data:,"?e.cloneNode(!1):Ke(t)}async function or(e,t){if(e.currentSrc){const i=document.createElement("canvas"),o=i.getContext("2d");i.width=e.clientWidth,i.height=e.clientHeight,o?.drawImage(e,0,0,i.width,i.height);const l=i.toDataURL();return Ke(l)}const n=e.poster,s=Lt(n),r=await At(n,s,t);return Ke(r)}async function lr(e){var t;try{if(!((t=e?.contentDocument)===null||t===void 0)&&t.body)return await Ye(e.contentDocument.body,{},!0)}catch{}return e.cloneNode(!1)}async function ar(e,t){return R(e,HTMLCanvasElement)?ir(e):R(e,HTMLVideoElement)?or(e,t):R(e,HTMLIFrameElement)?lr(e):e.cloneNode(!1)}const cr=e=>e.tagName!=null&&e.tagName.toUpperCase()==="SLOT";async function ur(e,t,n){var s,r;let i=[];return cr(e)&&e.assignedNodes?i=Y(e.assignedNodes()):R(e,HTMLIFrameElement)&&(!((s=e.contentDocument)===null||s===void 0)&&s.body)?i=Y(e.contentDocument.body.childNodes):i=Y(((r=e.shadowRoot)!==null&&r!==void 0?r:e).childNodes),i.length===0||R(e,HTMLVideoElement)||await i.reduce((o,l)=>o.then(()=>Ye(l,n)).then(a=>{a&&t.appendChild(a)}),Promise.resolve()),t}function fr(e,t){const n=t.style;if(!n)return;const s=window.getComputedStyle(e);s.cssText?(n.cssText=s.cssText,n.transformOrigin=s.transformOrigin):Y(s).forEach(r=>{let i=s.getPropertyValue(r);r==="font-size"&&i.endsWith("px")&&(i=`${Math.floor(parseFloat(i.substring(0,i.length-2)))-.1}px`),R(e,HTMLIFrameElement)&&r==="display"&&i==="inline"&&(i="block"),r==="d"&&t.getAttribute("d")&&(i=`path(${t.getAttribute("d")})`),n.setProperty(r,i,s.getPropertyPriority(r))})}function dr(e,t){R(e,HTMLTextAreaElement)&&(t.innerHTML=e.value),R(e,HTMLInputElement)&&t.setAttribute("value",e.value)}function gr(e,t){if(R(e,HTMLSelectElement)){const n=t,s=Array.from(n.children).find(r=>e.value===r.getAttribute("value"));s&&s.setAttribute("selected","")}}function hr(e,t){return R(t,Element)&&(fr(e,t),er(e,t),dr(e,t),gr(e,t)),t}async function mr(e,t){const n=e.querySelectorAll?e.querySelectorAll("use"):[];if(n.length===0)return e;const s={};for(let i=0;i<n.length;i++){const l=n[i].getAttribute("xlink:href");if(l){const a=e.querySelector(l),c=document.querySelector(l);!a&&c&&!s[l]&&(s[l]=await Ye(c,t,!0))}}const r=Object.values(s);if(r.length){const i="http://www.w3.org/1999/xhtml",o=document.createElementNS(i,"svg");o.setAttribute("xmlns",i),o.style.position="absolute",o.style.width="0",o.style.height="0",o.style.overflow="hidden",o.style.display="none";const l=document.createElementNS(i,"defs");o.appendChild(l);for(let a=0;a<r.length;a++)l.appendChild(r[a]);e.appendChild(o)}return e}async function Ye(e,t,n){return!n&&t.filter&&!t.filter(e)?null:Promise.resolve(e).then(s=>ar(s,t)).then(s=>ur(e,s,t)).then(s=>hr(e,s)).then(s=>mr(s,t))}const $n=/url\((['"]?)([^'"]+?)\1\)/g,pr=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,Cr=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function yr(e){const t=e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${t})(['"]?\\))`,"g")}function br(e){const t=[];return e.replace($n,(n,s,r)=>(t.push(r),n)),t.filter(n=>!Ct(n))}async function wr(e,t,n,s,r){try{const i=n?js(t,n):t,o=Lt(t);let l;if(r){const a=await r(i);l=Sn(a,o)}else l=await At(i,o,s);return e.replace(yr(t),`$1${l}$3`)}catch{}return e}function xr(e,{preferredFontFormat:t}){return t?e.replace(Cr,n=>{for(;;){const[s,,r]=pr.exec(n)||[];if(!r)return"";if(r===t)return`src: ${s};`}}):e}function _n(e){return e.search($n)!==-1}async function kn(e,t,n){if(!_n(e))return e;const s=xr(e,n);return br(s).reduce((i,o)=>i.then(l=>wr(l,o,t,n)),Promise.resolve(s))}async function Ve(e,t,n){var s;const r=(s=t.style)===null||s===void 0?void 0:s.getPropertyValue(e);if(r){const i=await kn(r,null,n);return t.style.setProperty(e,i,t.style.getPropertyPriority(e)),!0}return!1}async function Sr(e,t){await Ve("background",e,t)||await Ve("background-image",e,t),await Ve("mask",e,t)||await Ve("mask-image",e,t)}async function vr(e,t){const n=R(e,HTMLImageElement);if(!(n&&!Ct(e.src))&&!(R(e,SVGImageElement)&&!Ct(e.href.baseVal)))return;const s=n?e.src:e.href.baseVal,r=await At(s,Lt(s),t);await new Promise((i,o)=>{e.onload=i,e.onerror=o;const l=e;l.decode&&(l.decode=i),l.loading==="lazy"&&(l.loading="eager"),n?(e.srcset="",e.src=r):e.href.baseVal=r})}async function $r(e,t){const s=Y(e.childNodes).map(r=>En(r,t));await Promise.all(s).then(()=>e)}async function En(e,t){R(e,Element)&&(await Sr(e,t),await vr(e,t),await $r(e,t))}function _r(e,t){const{style:n}=e;t.backgroundColor&&(n.backgroundColor=t.backgroundColor),t.width&&(n.width=`${t.width}px`),t.height&&(n.height=`${t.height}px`);const s=t.style;return s!=null&&Object.keys(s).forEach(r=>{n[r]=s[r]}),e}const Ut={};async function zt(e){let t=Ut[e];if(t!=null)return t;const s=await(await fetch(e)).text();return t={url:e,cssText:s},Ut[e]=t,t}async function Gt(e,t){let n=e.cssText;const s=/url\(["']?([^"')]+)["']?\)/g,i=(n.match(/url\([^)]+\)/g)||[]).map(async o=>{let l=o.replace(s,"$1");return l.startsWith("https://")||(l=new URL(l,e.url).href),vn(l,t.fetchRequestInit,({result:a})=>(n=n.replace(o,`url(${a})`),[o,a]))});return Promise.all(i).then(()=>n)}function Zt(e){if(e==null)return[];const t=[],n=/(\/\*[\s\S]*?\*\/)/gi;let s=e.replace(n,"");const r=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;;){const a=r.exec(s);if(a===null)break;t.push(a[0])}s=s.replace(r,"");const i=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,o="((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})",l=new RegExp(o,"gi");for(;;){let a=i.exec(s);if(a===null){if(a=l.exec(s),a===null)break;i.lastIndex=l.lastIndex}else l.lastIndex=i.lastIndex;t.push(a[0])}return t}async function kr(e,t){const n=[],s=[];return e.forEach(r=>{if("cssRules"in r)try{Y(r.cssRules||[]).forEach((i,o)=>{if(i.type===CSSRule.IMPORT_RULE){let l=o+1;const a=i.href,c=zt(a).then(u=>Gt(u,t)).then(u=>Zt(u).forEach(f=>{try{r.insertRule(f,f.startsWith("@import")?l+=1:r.cssRules.length)}catch(d){console.error("Error inserting rule from remote css",{rule:f,error:d})}})).catch(u=>{console.error("Error loading remote css",u.toString())});s.push(c)}})}catch(i){const o=e.find(l=>l.href==null)||document.styleSheets[0];r.href!=null&&s.push(zt(r.href).then(l=>Gt(l,t)).then(l=>Zt(l).forEach(a=>{o.insertRule(a,r.cssRules.length)})).catch(l=>{console.error("Error loading remote stylesheet",l)})),console.error("Error inlining remote css file",i)}}),Promise.all(s).then(()=>(e.forEach(r=>{if("cssRules"in r)try{Y(r.cssRules||[]).forEach(i=>{n.push(i)})}catch(i){console.error(`Error while reading CSS rules from ${r.href}`,i)}}),n))}function Er(e){return e.filter(t=>t.type===CSSRule.FONT_FACE_RULE).filter(t=>_n(t.style.getPropertyValue("src")))}async function Lr(e,t){if(e.ownerDocument==null)throw new Error("Provided element is not within a Document");const n=Y(e.ownerDocument.styleSheets),s=await kr(n,t);return Er(s)}async function Ar(e,t){const n=await Lr(e,t);return(await Promise.all(n.map(r=>{const i=r.parentStyleSheet?r.parentStyleSheet.href:null;return kn(r.cssText,i,t)}))).join(`
`)}async function Tr(e,t){const n=t.fontEmbedCSS!=null?t.fontEmbedCSS:t.skipFonts?null:await Ar(e,t);if(n){const s=document.createElement("style"),r=document.createTextNode(n);s.appendChild(r),e.firstChild?e.insertBefore(s,e.firstChild):e.appendChild(s)}}async function Ir(e,t={}){const{width:n,height:s}=xn(e,t),r=await Ye(e,t,!0);return await Tr(r,t),await En(r,t),_r(r,t),await Xs(r,n,s)}async function Ln(e,t={}){const{width:n,height:s}=xn(e,t),r=await Ir(e,t),i=await Ke(r),o=document.createElement("canvas"),l=o.getContext("2d"),a=t.pixelRatio||Zs(),c=t.canvasWidth||n,u=t.canvasHeight||s;return o.width=c*a,o.height=u*a,t.skipAutoScale||Ws(o),o.style.width=`${c}`,o.style.height=`${u}`,t.backgroundColor&&(l.fillStyle=t.backgroundColor,l.fillRect(0,0,o.width,o.height)),l.drawImage(i,0,0,o.width,o.height),o}async function Pr(e,t={}){return(await Ln(e,t)).toDataURL("image/jpeg",t.quality||1)}async function Mr(e,t={}){const n=await Ln(e,t);return await qs(n)}const Rr=w(`<label class="relative inline-flex items-center cursor-pointer ml-1"><input type="checkbox"><div class="w-9 h-5 bg-slate bg-op-15 peer-focus:outline-none peer-focus:ring-0 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-slate">`),Or=w('<select name="model">'),Fr=w("<option>");function at(e){return(()=>{const t=Rr(),n=t.firstChild;return be(n,"change",e.onChange),E(()=>xe(n,`sr-only peer ${e.class}`)),E(()=>n.checked=e.checked),t})()}function Dr(e){return(()=>{const t=Or();return be(t,"change",e.onChange),y(t,()=>p(wt,{get each(){return e.options},children:n=>(()=>{const s=Fr();return y(s,()=>n.label),E(()=>s.value=n.value),s})()})),E(()=>xe(t,`w-full bg-slate bg-op-15 rounded-sm appearance-none accent-slate text-center focus:bg-op-20 focus:ring-0 focus:outline-none ${e.class??""}`)),E(()=>t.value=e.value),t})()}const Wt=w('<input type="password" class="input-box">'),qt=w('<div class="<sm:max-h-10em max-h-14em overflow-y-auto">'),Kt=w('<hr class="my-1 bg-slate-5 bg-op-15 border-none h-1px">'),Br=w('<input type="text" class="input-box text-ellipsis">'),Hr=w('<div class="flex items-center justify-between w-150px"><input type="range" min="0" max="100" class="bg-slate max-w-100px w-full h-2 bg-op-15 rounded-lg appearance-none cursor-pointer accent-slate"><span class="bg-slate bg-op-15 rounded-sm px-1 text-10px">'),ct=w('<div class="flex">'),Nr=w('<div class="text-sm text-slate-7 dark:text-slate my-2"><div class="flex items-center justify-between"><div class="flex">'),Vr=w('<div class="flex items-center p-1 justify-between hover:bg-slate hover:bg-op-10 rounded"><div class="flex items-center"><button></button><span class="ml-1">'),jr=w('<div class="flex items-center cursor-pointer mx-1 p-2 hover:dark:bg-#23252A hover:bg-#ECF0F4 rounded text-1.2em"><button>'),[I,A]=on({showSetting:"none",success:!1,genImg:"normal",fakeRole:"normal",clearSessionConfirm:!1,deleteSessionConfirm:!1}),Ur={success:"i-carbon:status-resolved dark:text-yellow text-yellow-6",normal:"i-carbon:image",loading:"i-ri:loader-2-line animate-spin",error:"i-carbon:warning-alt text-red-6 dark:text-red"},zr={assistant:"i-ri:android-fill bg-gradient-to-r from-yellow-300 to-red-700 ",normal:"i-ri:user-3-line",user:"i-ri:user-3-fill bg-gradient-to-r from-red-300 to-blue-700 "};function Gr(){const{store:e,setStore:t}=ue,n=xt();function s(){t("messageList",r=>r.filter(i=>i.type==="locked"))}return(()=>{const r=Nr(),i=r.firstChild,o=i.firstChild;return Oe(Rs,r,()=>()=>{A("showSetting","none")}),y(r,p(Rt,{get children(){return[p(He,{get when(){return I.showSetting==="global"},get children(){return[(()=>{const l=qt();return y(l,p(te,{icon:"i-ri:lock-password-line",label:"网站访问密码",get children(){const a=Wt();return a.$$input=c=>{t("globalSettings","password",c.target.value)},E(()=>a.value=e.globalSettings.password),a}}),null),y(l,p(te,{icon:"i-carbon:api",label:"OpenAI Key",get children(){const a=Wt();return a.$$input=c=>{t("globalSettings","APIKey",c.target.value)},E(()=>a.value=e.globalSettings.APIKey),a}}),null),y(l,p(te,{icon:"i-carbon:keyboard",label:"Enter 键发送消息",get children(){return p(at,{get checked(){return e.globalSettings.enterToSend},onChange:a=>{t("globalSettings","enterToSend",a.target.checked)}})}}),null),l})(),Kt()]}}),p(He,{get when(){return I.showSetting==="session"},get children(){return[(()=>{const l=qt();return y(l,p(P,{get when(){return e.sessionId!=="index"},get children(){return p(te,{icon:"i-carbon:text-annotation-toggle",label:"对话标题",get children(){const a=Br();return a.$$input=c=>{t("sessionSettings","title",c.target.value)},E(()=>a.value=e.sessionSettings.title),a}})}}),null),y(l,p(te,{icon:"i-carbon:machine-learning-model",label:"OpenAI 模型",get children(){return p(Dr,{class:"max-w-150px",get value(){return e.sessionSettings.model},onChange:a=>{t("sessionSettings","model",a.target.value)},options:[{value:"gpt-3.5",label:"gpt-3.5(auto)"},{value:"gpt-4",label:"gpt-4(auto)"}]})}}),null),y(l,p(te,{icon:"i-carbon:data-enrichment",label:"思维发散程度",get children(){const a=Hr(),c=a.firstChild,u=c.nextSibling;return c.$$input=f=>{t("sessionSettings","APITemperature",Number(f.target.value)/50)},y(u,()=>e.sessionSettings.APITemperature.toFixed(2)),E(()=>c.value=String(e.sessionSettings.APITemperature*50)),a}}),null),y(l,p(te,{icon:"i-carbon:save-image",label:"记录对话内容",get children(){return p(at,{get checked(){return e.sessionSettings.saveSession},onChange:a=>{t("sessionSettings","saveSession",a.target.checked)}})}}),null),y(l,p(te,{icon:"i-carbon:3d-curve-auto-colon",label:"开启连续对话",get children(){return p(at,{get checked(){return e.sessionSettings.continuousDialogue},onChange:a=>{t("sessionSettings","continuousDialogue",a.target.checked)}})}}),null),l})(),Kt()]}})]}}),i),y(o,p(U,{onClick:()=>{A("showSetting",l=>l!=="global"?"global":"none")},icon:"i-carbon:settings",label:"全局设置"}),null),y(o,p(U,{onClick:()=>{A("showSetting",l=>l!=="session"?"session":"none")},icon:"i-carbon:settings-services",label:"对话设置"}),null),y(i,p(Rt,{get fallback(){return(()=>{const l=ct();return y(l,p(U,{onClick:()=>{A("fakeRole",a=>{const c=["normal","user","assistant"];return c[(c.indexOf(a)+1)%c.length]})},get icon(){return zr[I.fakeRole]},label:"伪装角色"}),null),y(l,p(U,{onClick:async()=>{A("genImg","loading"),await Zr(),setTimeout(()=>A("genImg","normal"),1e3)},get icon(){return Ur[I.genImg]},label:"导出图片"}),null),y(l,p(U,{label:"导出MD",onClick:async()=>{await Wr(e.messageList),A("success","markdown"),setTimeout(()=>A("success",!1),1e3)},get icon(){return I.success==="markdown"?"i-carbon:status-resolved dark:text-yellow text-yellow-6":"i-ri:markdown-line"}}),null),y(l,p(U,{onClick:()=>{I.clearSessionConfirm?(s(),A("clearSessionConfirm",!1)):(A("clearSessionConfirm",!0),setTimeout(()=>A("clearSessionConfirm",!1),3e3))},get icon(){return I.clearSessionConfirm?"i-carbon:checkmark animate-bounce text-red-6 dark:text-red":"i-carbon:clean"},get label(){return I.clearSessionConfirm?"确定":"清空对话"}}),null),l})()},get children(){return[p(He,{get when(){return I.showSetting==="global"},get children(){const l=ct();return y(l,p(U,{label:"导出",onClick:qr,icon:"i-carbon:export"}),null),y(l,p(U,{label:"导入",onClick:Kr,icon:"i-carbon:download"}),null),l}}),p(He,{get when(){return I.showSetting==="session"},get children(){const l=ct();return y(l,p(U,{onClick:()=>{let a;do a=$t();while(vt(a));ln(a,{id:a,lastVisit:Date.now(),settings:{...Se.CLIENT_SESSION_SETTINGS,title:"新的对话"},messages:[]}),n(`/session/${a}`),Me(a)},icon:"i-carbon:add-alt",label:"新的对话"}),null),y(l,p(P,{get when(){return e.sessionId!=="index"},get children(){return[p(U,{onClick:async()=>{await Je(window.location.origin+window.location.pathname),A("success","link"),setTimeout(()=>A("success",!1),1e3)},get icon(){return I.success==="link"?"i-carbon:status-resolved dark:text-yellow text-yellow-6":"i-carbon:link"},label:"复制链接"}),p(U,{onClick:()=>{I.deleteSessionConfirm?(A("deleteSessionConfirm",!1),rs(e.sessionId),n("/",{replace:!0}),Me("index")):(A("deleteSessionConfirm",!0),setTimeout(()=>A("deleteSessionConfirm",!1),3e3))},get icon(){return I.deleteSessionConfirm?"i-carbon:checkmark animate-bounce text-red-6 dark:text-red":"i-carbon:trash-can"},get label(){return I.deleteSessionConfirm?"确定":"删除对话"}})]}}),null),l}})]}}),null),r})()}function te(e){return(()=>{const t=Vr(),n=t.firstChild,s=n.firstChild,r=s.nextSibling;return y(r,()=>e.label),y(t,()=>e.children,null),E(()=>xe(s,e.icon)),t})()}function U(e){return(()=>{const t=jr(),n=t.firstChild;return be(t,"click",e.onClick,!0),me(t,"position","top"),E(s=>{const r=e.label,i=e.icon,o=e.label;return r!==s._v$&&me(t,"tooltip",s._v$=r),i!==s._v$2&&xe(n,s._v$2=i),o!==s._v$3&&me(n,"title",s._v$3=o),s},{_v$:void 0,_v$2:void 0,_v$3:void 0}),t})()}async function Zr(){try{const e=document.querySelector("#message-container-img"),t=document.querySelector("header");async function n(){const s=await Pr(e),r=document.createElement("a");r.href=s,r.download=`ChatGPT-${cn(new Date,"HH-MM-SS")}.jpg`,r.click()}if(!an()&&navigator.clipboard)try{const s=await Mr(e);s&&await navigator.clipboard.write([new ClipboardItem({[s.type]:s})])}catch{await n()}else await n();A("genImg","success")}catch{A("genImg","error")}}async function Wr(e){const t=e.reduce((n,s)=>((s.role==="assistant"||s.role==="user")&&(s.role==="user"?n.push([s]):n[n.length-1].push(s)),n),[]);await Je(t.filter(n=>n.length===2).map(n=>`> ${n[0].content}

${n[1].content}`).join(`

---

`))}async function qr(){const e=document.createElement("a");e.href=URL.createObjectURL(new Blob([JSON.stringify(localStorage)],{type:"application/json"})),e.download=`ChatGPT-${cn(new Date,"HH-MM-SS")}.json`,e.click()}async function Kr(){const e=document.createElement("input");e.type="file",e.accept="application/json",e.click(),e.onchange=async()=>{const t=e.files?.[0];if(t){const n=await t.text(),s=JSON.parse(n);localStorage.clear(),Object.keys(s).forEach(r=>{localStorage.setItem(r,s[r])}),window.location.href="/"}}}ce(["input","click"]);const Xr=w('<ul class="bg-slate bg-op-20 dark:text-slate text-slate-7 overflow-y-auto rounded-t">'),Xt=w('<b class="dark:text-slate-2 text-black">'),Jr=w('<li class="hover:bg-slate hover:bg-op-20 py-1 px-3"><p class="truncate"></p><p class="text-0.5em truncate">'),Jt=350;function Yr(e){let t;const[n,s]=H(0),[r,i]=H(Jt);return Re(()=>{St(window,"keydown",o=>{o.key==="ArrowDown"?s(n()+1):o.key==="ArrowUp"?s(n()-1):o.keyCode===13?e.select(e.options[n()]):o.key==="Escape"&&e.select()},{passive:!0})}),M(()=>{n()<0?s(0):n()&&n()>=e.options.length&&s(e.options.length-1)}),M(()=>{e.options,t&&e.options.length&&i(t.clientHeight>window.innerHeight-130?window.innerHeight-130:Jt)}),p(P,{get when(){return e.options.length},get children(){const o=Xr(),l=t;return typeof l=="function"?Oe(l,o):t=o,y(o,p(wt,{get each(){return e.options},children:(a,c)=>p(Qr,{option:a,get select(){return e.select},get hover(){return n()===c()}})})),E(()=>r()+"px"!=null?o.style.setProperty("max-height",r()+"px"):o.style.removeProperty("max-height")),o}})}function Qr(e){let t;M(()=>{e.hover&&(t.focus(),t.scrollIntoView({block:"center"}))});let n=e.option.title,s=e.option.desc;if(e.option.positions?.size){const r=e.option.title.length,i=[0,r-1],o=[r+1,e.option.desc.length-1],{titleIndexs:l,descIndexs:a}=Array.from(e.option.positions).sort((c,u)=>c-u).reduce((c,u)=>(u>=i[0]&&u<=i[1]?c.titleIndexs.push(u):u>=o[0]&&u<=o[1]&&c.descIndexs.push(u-r-1),c),{titleIndexs:[],descIndexs:[]});l.length&&(n=e.option.title.split("").map((c,u)=>l.includes(u)?(()=>{const f=Xt();return y(f,c),f})():c)),a.length&&(s=e.option.desc.split("").map((c,u)=>{if(a.includes(u))return(()=>{const f=Xt();return y(f,c),f})();if(a[0]-5<u&&a[a.length-1]+100>u)return c}))}return(()=>{const r=Jr(),i=r.firstChild,o=i.nextSibling;r.$$click=()=>{e.select(e.option)};const l=t;return typeof l=="function"?Oe(l,r):t=r,y(i,n),y(o,s),E(a=>{const c=!!e.hover,u=!!e.hover;return c!==a._v$&&r.classList.toggle("bg-slate",a._v$=c),u!==a._v$2&&r.classList.toggle("bg-op-20",a._v$2=u),a},{_v$:void 0,_v$2:void 0}),r})()}ce(["click"]);const ei=w('<div class="absolute flex text-1em items-center"><button class="i-carbon:add-filled rotate-45 text-slate-7 dark:text-slate text-op-20! hover:text-op-60!">'),ti=w('<div class="flex items-end relative"><textarea id="input" placeholder="与 ta 对话吧" autocomplete="off" autofocus class="self-end p-3 pr-2.2em resize-none w-full text-slate-7 dark:text-slate bg-slate bg-op-15 focus:bg-op-20 focus:ring-0 focus:outline-none placeholder:text-slate-800 placeholder:dark:text-slate-400 placeholder:op-40 rounded-b"></textarea><div class="absolute right-0.5em bottom-0.8em flex items-center"><button title="发送" class="i-carbon:send-filled text-1.5em text-slate-7 dark:text-slate text-op-80! hover:text-op-100!">'),ni=w('<div class="pb-2em px-2em fixed bottom-0 z-100"><div>'),si=w('<div class="animate-gradient-border cursor-pointer dark:bg-#292B31/90 bg-#E7EBF0/80 h-3em flex items-center justify-center"><span class="dark:text-slate text-slate-7">AI 正在思考 / <!> / $'),se=48;function ri({width:e,height:t,setHeight:n,sendMessage:s,stopStreamFetch:r}){const[i,o]=H([]),[l,a]=H(!0),c=xt(),{store:u,setStore:f}=ue;Re(()=>{Hn(()=>import("./parse-7a2f1863.js"),[]).then(({parsePrompts:g})=>{z.promptOptions=g().map(S=>({title:S.desc,desc:S.detail})),z.fzfPrompts=new wn(z.promptOptions,{selector:S=>`${S.title}
${S.desc}`})}),u.inputRef?.focus()});function d(){const g=u.inputRef?.scrollHeight;g&&n(g>window.innerHeight/2?window.innerHeight/2:g)}M(g=>(u.inputContent,g&&oe(()=>{n(se),u.inputContent===""?o([]):d()}),!0));function h(g){oe(()=>{g&&(g.extra?.id?g.extra?.id==="index"?window.location.href="/":(c(`/session/${g.extra.id}`),Me(g.extra.id),f("inputContent","")):f("inputContent",g.desc)),o([]),d()})}const C=Ce(g=>{if(/^\s{2,}$|^\/{2,}$/.test(g))return o(z.sessionOptions);if(g==="/"||g===" ")return o(z.promptOptions);const S=g.replace(/^\s{2,}(.*)\s*$|^\/{2,}(.*)\s*$/,"$1$2"),_=g.replace(/^\s(.*)\s*$|^\/(.*)\s*$/,"$1$2");S!==g?o(z.fzfSessions.find(S).map(b=>({...b.item,positions:b.positions}))):_!==g&&o(z.fzfPrompts.find(_).map(b=>({...b.item,positions:b.positions})))},100);async function m(){n(se-1),oe(()=>{if(d(),!l())return;const g=u.inputRef?.value;g?(f("inputContent",g),C(g)):(f("inputContent",""),o([]))})}const x=g=>g>1e3?(g/1e3).toFixed(1)+"k":g;return(()=>{const g=ni(),S=g.firstChild;return g.style.setProperty("background-color","var(--c-bg)"),S.style.setProperty("transition","opacity 1s ease-in-out"),y(S,p(P,{get when(){return D(()=>!u.loading)()&&!i().length},get children(){return p(Gr,{})}}),null),y(S,p(P,{get when(){return!u.loading},get fallback(){return(()=>{const _=si(),b=_.firstChild,T=b.firstChild,O=T.nextSibling;return O.nextSibling,be(_,"click",r,!0),y(b,()=>x(u.currentMessageToken),O),y(b,()=>u.currentMessageToken$.toFixed(4),null),_})()},get children(){return[p(Yr,{get options(){return i()},select:h}),(()=>{const _=ti(),b=_.firstChild,T=b.nextSibling,O=T.firstChild;return b.addEventListener("compositionend",()=>{a(!0),m()}),b.addEventListener("compositionstart",()=>{a(!1)}),b.$$input=m,b.$$keydown=v=>{if(!v.isComposing){if(i().length)(v.key==="ArrowUp"||v.key==="ArrowDown"||v.keyCode===13)&&v.preventDefault();else if(v.keyCode===13)!v.shiftKey&&u.globalSettings.enterToSend&&(v.preventDefault(),s(void 0,I.fakeRole));else if(v.key==="ArrowUp"){const N=u.messageList.filter(W=>W.role==="user").map(W=>W.content).at(-1);N&&!u.inputContent&&(v.preventDefault(),f("inputContent",N))}}},be(b,"click",je,!0),Oe(v=>f("inputRef",v),b),y(_,p(P,{get when(){return u.inputContent},get children(){const v=ei(),Z=v.firstChild;return Z.$$click=()=>{f("inputContent",""),u.inputRef?.focus()},E(N=>Bn(v,{"right-2.5em bottom-1em":t()===se,"right-0.8em top-0.8em":t()!==se},N)),v}}),T),O.$$click=()=>s(void 0,I.fakeRole),E(v=>{const Z=t()+"px",N=i().length===0;return Z!==v._v$&&((v._v$=Z)!=null?b.style.setProperty("height",Z):b.style.removeProperty("height")),N!==v._v$2&&b.classList.toggle("rounded-t",v._v$2=N),v},{_v$:void 0,_v$2:void 0}),E(()=>b.value=u.inputContent),_})()]}}),null),E(_=>{const b=e()==="init"?"100%":e(),T=e()==="init"?0:100;return b!==_._v$3&&((_._v$3=b)!=null?g.style.setProperty("width",b):g.style.removeProperty("width")),T!==_._v$4&&((_._v$4=T)!=null?S.style.setProperty("opacity",T):S.style.removeProperty("opacity")),_},{_v$3:void 0,_v$4:void 0}),g})()}ce(["click","keydown","input"]);var Yt=()=>{};function ii(e,t){const n=tt(e),{onChange:s}=t;let r=new Set(t.appear?void 0:n);const i=new WeakSet,[o,l]=H([],{equals:!1}),[a]=Nn(),c=t.exitMethod==="remove"?Yt:f=>{l(d=>(d.push.apply(d,f),d));for(const d of f)i.delete(d)},u=t.exitMethod==="remove"?Yt:t.exitMethod==="keep-index"?(f,d,h)=>f.splice(h,0,d):(f,d)=>f.push(d);return D(f=>{const d=o(),h=e();if(h[ut],tt(a))return a(),f;if(d.length){const C=f.filter(m=>!d.includes(m));return d.length=0,s({list:C,added:[],removed:[],unchanged:C,finishRemoved:c}),C}return tt(()=>{const C=new Set(h),m=h.slice(),x=[],g=[],S=[];for(const b of h)(r.has(b)?S:x).push(b);let _=!x.length;for(let b=0;b<f.length;b++){const T=f[b];C.has(T)||(i.has(T)||(g.push(T),i.add(T)),u(m,T,b)),_&&T!==m[b]&&(_=!1)}return!g.length&&_?f:(s({list:m,added:x,removed:g,unchanged:S,finishRemoved:c}),r=C,m)})},t.appear?[]:n.slice())}var Qt=e=>e instanceof Element;function yt(e,t){if(t(e))return e;if(typeof e=="function"&&!e.length)return yt(e(),t);if(Array.isArray(e)){const n=[];for(const s of e){const r=yt(s,t);r&&(Array.isArray(r)?n.push.apply(n,r):n.push(r))}return n.length?n:null}return null}function oi(e,t=Qt,n=Qt){const s=D(e),r=D(()=>yt(s(),t));return r.toArray=()=>{const i=r();return Array.isArray(i)?i:i?[i]:[]},r}function li(e){return D(()=>{const t=e.name||"s";return{enterActive:(e.enterActiveClass||t+"-enter-active").split(" "),enter:(e.enterClass||t+"-enter").split(" "),enterTo:(e.enterToClass||t+"-enter-to").split(" "),exitActive:(e.exitActiveClass||t+"-exit-active").split(" "),exit:(e.exitClass||t+"-exit").split(" "),exitTo:(e.exitToClass||t+"-exit-to").split(" "),move:(e.moveClass||t+"-move").split(" ")}})}function An(e){requestAnimationFrame(()=>requestAnimationFrame(e))}function ai(e,t,n,s){const{onBeforeEnter:r,onEnter:i,onAfterEnter:o}=t;r?.(n),n.classList.add(...e.enter),n.classList.add(...e.enterActive),queueMicrotask(()=>{if(!n.parentNode)return s?.();i?.(n,()=>l())}),An(()=>{n.classList.remove(...e.enter),n.classList.add(...e.enterTo),(!i||i.length<2)&&(n.addEventListener("transitionend",l),n.addEventListener("animationend",l))});function l(a){(!a||a.target===n)&&(s?.(),n.removeEventListener("transitionend",l),n.removeEventListener("animationend",l),n.classList.remove(...e.enterActive),n.classList.remove(...e.enterTo),o?.(n))}}function ci(e,t,n,s){const{onBeforeExit:r,onExit:i,onAfterExit:o}=t;if(!n.parentNode)return s?.();r?.(n),n.classList.add(...e.exit),n.classList.add(...e.exitActive),i?.(n,()=>l()),An(()=>{n.classList.remove(...e.exit),n.classList.add(...e.exitTo),(!i||i.length<2)&&(n.addEventListener("transitionend",l),n.addEventListener("animationend",l))});function l(a){(!a||a.target===n)&&(s?.(),n.removeEventListener("transitionend",l),n.removeEventListener("animationend",l),n.classList.remove(...e.exitActive),n.classList.remove(...e.exitTo),o?.(n))}}var ui=e=>{const t=li(e);return ii(oi(()=>e.children).toArray,{appear:e.appear,exitMethod:"keep-index",onChange({added:n,removed:s,finishRemoved:r,list:i}){const o=t();for(const a of n)ai(o,e,a);const l=[];for(const a of i)a.isConnected&&(a instanceof HTMLElement||a instanceof SVGElement)&&l.push({el:a,rect:a.getBoundingClientRect()});queueMicrotask(()=>{const a=[];for(const{el:c,rect:u}of l)if(c.isConnected){const f=c.getBoundingClientRect(),d=u.left-f.left,h=u.top-f.top;(d||h)&&(c.style.transform=`translate(${d}px, ${h}px)`,c.style.transitionDuration="0s",a.push(c))}document.body.offsetHeight;for(const c of a){let u=function(f){(f.target===c||/transform$/.test(f.propertyName))&&(c.removeEventListener("transitionend",u),c.classList.remove(...o.move))};c.classList.add(...o.move),c.style.transform=c.style.transitionDuration="",c.addEventListener("transitionend",u)}});for(const a of s)ci(o,e,a,()=>r([a]))}})};const fi=w('<span class="mx-1 text-slate/40"><span>'),di=w('<div class="flex items-center px-1em text-0.8em"><hr class="flex-1 border-slate/40"><hr class="flex-1 border-slate/30">'),gi=w('<div class="px-1em" id="message-container"><div id="message-container-img" class="px-1em">'),hi=w('<span class="mx-1 text-slate/40">');function mi({sendMessage:e,inputBoxHeight:t}){const{store:n}=ue,s=D(i=>t()===se-1?i:t(),se);M(i=>(i!==void 0&&n.messageList.length>i&&je(),n.messageList.length)),M(i=>{n.currentAssistantMessage&&je()}),M(i=>(t(),i&&s()!==se&&je(),!0));const r=i=>i>1e3?(i/1e3).toFixed(1)+"k":i;return(()=>{const i=gi(),o=i.firstChild;return y(o,p(P,{get when(){return!n.messageList.length},get children(){return p(Ht,{hiddenAction:!0,message:Ts})}}),null),y(o,p(ui,{name:"transition-group",get children(){return p(wt,{get each(){return n.messageList},children:(l,a)=>p(Ht,{message:l,get hiddenAction(){return n.loading||l.type==="temporary"},get index(){return a()},sendMessage:e})})}}),null),y(i,p(P,{get when(){return!n.loading&&(n.contextToken||n.inputContentToken)},get children(){const l=di(),a=l.firstChild,c=a.nextSibling;return y(l,p(P,{get when(){return n.inputContentToken},get fallback(){return(()=>{const u=hi();return y(u,()=>`有效上下文 Tokens : ${r(n.contextToken)}/$${n.contextToken$.toFixed(4)}`),u})()},get children(){const u=fi(),f=u.firstChild;return y(u,()=>`有效上下文+提问 Tokens : ${r(n.contextToken+n.inputContentToken)}(`,f),y(f,()=>r(n.remainingToken)),y(u,()=>`)/$${(n.contextToken$+n.inputContentToken$).toFixed(4)}`,null),E(()=>f.classList.toggle("text-red-500",n.remainingToken<0)),u}}),c),l}}),null),E(()=>`calc(6em + ${s()+"px"})`!=null?i.style.setProperty("margin-bottom",`calc(6em + ${s()+"px"})`):i.style.removeProperty("margin-bottom")),i})()}const pi=w('<main class="mt-4">'),Ci="q";function Bi(){let e,t;const[n,s]=H("init"),[r,i]=H(se),[o]=Vn(),l=o[Ci],{store:a,setStore:c}=ue;Re(()=>{ss(e,({width:C},m)=>{m===e&&s(`${C}px`)}),window.setTimeout(()=>{document.querySelector("#root")?.classList.remove("before")},100),document.querySelector("#root")?.classList.add("after"),Me(a.sessionId),l&&d(l)}),M(()=>{ln(a.sessionId,{id:a.sessionId,lastVisit:Date.now(),messages:a.sessionSettings.saveSession?a.messageList:a.messageList.filter(C=>C.type==="locked"),settings:a.sessionSettings})}),M(()=>{localStorage.setItem(re.GLOBALSETTINGS,JSON.stringify(a.globalSettings))});function u(){a.currentAssistantMessage&&(oe(()=>{c("messageList",C=>C.type==="temporary","type","default"),c("currentAssistantMessage",""),c("currentMessageToken",0),c("loading",!1)}),t=void 0),!an()&&a.inputRef?.focus()}function f(){t&&(t?.abort(),u())}async function d(C,m){const x=C??a.inputContent;if(x){if(c("inputContent",""),m==="assistant")A("fakeRole","normal"),a.messageList.at(-1)?.role!=="user"&&a.messageList.at(-2)?.role==="user"?c("messageList",a.messageList.length-1,{role:"assistant",content:x}):a.messageList.at(-1)?.role==="user"?c("messageList",g=>[...g,{role:"assistant",content:x}]):c("messageList",g=>[...g,{role:"user",content:x}]);else if(m==="user")A("fakeRole","normal"),c("messageList",g=>[...g,{role:"user",content:x}]);else try{if(c("messageList",g=>[...g,{role:"user",content:x}]),a.remainingToken<0)throw new Error(a.sessionSettings.continuousDialogue?"本次对话过长，请清除之前部分对话或者缩短当前提问。":"当前提问太长了，请缩短。");c("loading",!0),t=new AbortController,await h(a.sessionSettings.continuousDialogue?a.validContext:[...a.validContext,{role:"user",content:x}])}catch(g){c("loading",!1),t=void 0,g.message.includes("abort")||c("messageList",S=>[...S,{role:"error",content:g.message.replace(/(sk-\w{5})\w+/g,"$1")}])}u()}}async function h(C){const m=await fetch("/api",{method:"POST",body:JSON.stringify({messages:C,key:a.globalSettings.APIKey||void 0,temperature:a.sessionSettings.APITemperature,password:a.globalSettings.password,model:a.currentModel}),signal:t?.signal});if(!m.ok){const b=await m.json();throw new Error(b.error.message)}const x=m.body;if(!x)throw new Error("没有返回数据");const g=x.getReader(),S=new TextDecoder("utf-8");let _=!1;for(;!_;){const{value:b,done:T}=await g.read();if(b){const O=S.decode(b);if(O===`
`&&a.currentAssistantMessage.endsWith(`
`))continue;O&&oe(()=>{a.currentAssistantMessage?c("messageList",v=>v.type==="temporary","content",v=>v+O):c("messageList",v=>[...v,{role:"assistant",content:O,type:"temporary"}]),c("currentAssistantMessage",v=>v+O)})}_=T}}return(()=>{const C=pi(),m=e;return typeof m=="function"?Oe(m,C):e=C,y(C,p(mi,{sendMessage:d,inputBoxHeight:r}),null),y(C,p(ri,{height:r,width:n,setHeight:i,sendMessage:d,stopStreamFetch:f}),null),C})()}const yi=`<svg id="Icons" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"
  ><defs
    ><style>
      .cls-1 {
        fill: #ff8a14;
      }
      .cls-2 {
        fill: #adc4d9;
      }
      .cls-2,
      .cls-5,
      .cls-7,
      .cls-8,
      .cls-9 {
        stroke: #45413c;
        stroke-linecap: round;
        stroke-linejoin: round;
      }
      .cls-3 {
        fill: #ffe500;
      }
      .cls-4 {
        fill: #fff48c;
      }
      .cls-5 {
        fill: none;
      }
      .cls-13,
      .cls-6 {
        fill: #45413c;
      }
      .cls-6 {
        opacity: 0.15;
      }
      .cls-7 {
        fill: #fff;
      }
      .cls-8 {
        fill: #ff6242;
      }
      .cls-9 {
        fill: #6dd627;
      }
      .cls-10 {
        fill: #ffaa54;
      }
      .cls-11 {
        fill: #c0dceb;
      }
      .cls-12 {
        fill: #daedf7;
      }
    </style></defs
  ><title>ChatGPT</title><path
    id="_Path_"
    data-name="<Path>"
    class="cls-1"
    d="M2.34,39A4.06,4.06,0,0,1,1.16,33.4l7.47,4.86A4.05,4.05,0,0,1,3,39.45Z"
  ></path><path
    id="_Path_2"
    data-name="<Path>"
    class="cls-2"
    d="M33.5,17h-9l.58-2.38A1.46,1.46,0,0,1,26.5,13.5h5a1.47,1.47,0,0,1,1.42,1.11Z"
  ></path><path
    class="cls-3"
    d="M29,16A14.5,14.5,0,0,0,14.5,30.5V41A3.5,3.5,0,0,0,18,44.5H40A3.5,3.5,0,0,0,43.5,41V30.5A14.5,14.5,0,0,0,29,16Z"
  ></path><path
    class="cls-4"
    d="M29,16A14.5,14.5,0,0,0,14.5,30.5v4a14.5,14.5,0,0,1,29,0v-4A14.5,14.5,0,0,0,29,16Z"
  ></path><path
    class="cls-5"
    d="M29,16A14.5,14.5,0,0,0,14.5,30.5V41A3.5,3.5,0,0,0,18,44.5H40A3.5,3.5,0,0,0,43.5,41V30.5A14.5,14.5,0,0,0,29,16Z"
  ></path><ellipse
    id="_Ellipse_"
    data-name="<Ellipse>"
    class="cls-6"
    cx="29"
    cy="46.5"
    rx="16.5"
    ry="1.5"></ellipse><circle
    id="_Ellipse_2"
    data-name="<Ellipse>"
    class="cls-7"
    cx="35.89"
    cy="29.08"
    r="4.46"></circle><circle
    id="_Ellipse_3"
    data-name="<Ellipse>"
    class="cls-8"
    cx="35.89"
    cy="29.08"
    r="1.62"></circle><circle
    id="_Ellipse_4"
    data-name="<Ellipse>"
    class="cls-7"
    cx="22.11"
    cy="29.08"
    r="4.05"></circle><circle
    id="_Ellipse_5"
    data-name="<Ellipse>"
    class="cls-9"
    cx="22.11"
    cy="29.08"
    r="1.62"></circle><line
    id="_Line_"
    data-name="<Line>"
    class="cls-5"
    x1="29"
    y1="16"
    x2="29"
    y2="38"></line><line
    id="_Line_2"
    data-name="<Line>"
    class="cls-5"
    x1="35.89"
    y1="26.25"
    x2="35.89"
    y2="24.62"></line><line
    id="_Line_3"
    data-name="<Line>"
    class="cls-5"
    x1="37.9"
    y1="27.08"
    x2="39.04"
    y2="25.93"></line><line
    id="_Line_4"
    data-name="<Line>"
    class="cls-5"
    x1="38.73"
    y1="29.08"
    x2="40.35"
    y2="29.08"></line><line
    id="_Line_5"
    data-name="<Line>"
    class="cls-5"
    x1="37.9"
    y1="31.09"
    x2="39.04"
    y2="32.24"></line><line
    id="_Line_6"
    data-name="<Line>"
    class="cls-5"
    x1="35.89"
    y1="31.92"
    x2="35.89"
    y2="33.54"></line><line
    id="_Line_7"
    data-name="<Line>"
    class="cls-5"
    x1="33.88"
    y1="31.09"
    x2="32.74"
    y2="32.24"></line><line
    id="_Line_8"
    data-name="<Line>"
    class="cls-5"
    x1="33.05"
    y1="29.08"
    x2="31.43"
    y2="29.08"></line><line
    id="_Line_9"
    data-name="<Line>"
    class="cls-5"
    x1="33.88"
    y1="27.08"
    x2="32.74"
    y2="25.93"></line><polyline
    id="_Path_3"
    data-name="<Path>"
    class="cls-5"
    points="29 13.5 29 11.5 33.5 10 28 5 36 7 38.03 2.53"></polyline><circle
    id="_Ellipse_6"
    data-name="<Ellipse>"
    class="cls-8"
    cx="38.03"
    cy="2.53"
    r="2.03"></circle><path
    id="_Path_4"
    data-name="<Path>"
    class="cls-5"
    d="M14.5,36.38s-.5-5.27-2.93-4.87c-2.88.49-2,7.71.41,7.3,2-.34-1.62-6.89-4.46-6.08C5.93,33.19,5.1,35.25,5,35.92"
  ></path><path
    id="_Path_5"
    data-name="<Path>"
    class="cls-10"
    d="M1.08,33.55a4.76,4.76,0,0,0,2.26,4l.77.5a4.81,4.81,0,0,0,4.26.57,2,2,0,0,0,.26-.32L1.16,33.4A1.09,1.09,0,0,0,1.08,33.55Z"
  ></path><path
    id="_Path_6"
    data-name="<Path>"
    class="cls-5"
    d="M2.34,39A4.06,4.06,0,0,1,1.16,33.4l7.47,4.86A4.05,4.05,0,0,1,3,39.45Z"
  ></path><path class="cls-1" d="M47.5,35.5a4,4,0,0,1-4,4v-9a4,4,0,0,1,4,4Z"
  ></path><path
    class="cls-10"
    d="M43.5,30.5v2a4,4,0,0,1,4,3.5,4.07,4.07,0,0,0,0-.5v-1A4,4,0,0,0,43.5,30.5Z"
  ></path><path class="cls-5" d="M47.5,35.5a4,4,0,0,1-4,4v-9a4,4,0,0,1,4,4Z"
  ></path><rect
    class="cls-11"
    x="18.5"
    y="38"
    width="21"
    height="8"
    rx="1.5"
    ry="1.5"></rect><path
    class="cls-12"
    d="M38,38H20a1.5,1.5,0,0,0-1.5,1.5v2A1.5,1.5,0,0,1,20,40H38a1.5,1.5,0,0,1,1.5,1.5v-2A1.5,1.5,0,0,0,38,38Z"
  ></path><rect
    class="cls-5"
    x="18.5"
    y="38"
    width="21"
    height="8"
    rx="1.5"
    ry="1.5"></rect><path
    class="cls-13"
    d="M20.5,39.5a.5.5,0,1,0,.5.5.5.5,0,0,0-.5-.5Z"></path><path
    class="cls-13"
    d="M37.5,39.5a.5.5,0,1,0,.5.5.5.5,0,0,0-.5-.5Z"></path></svg
>
`;function bi(e,t=!1){const n=window.matchMedia(e),[s,r]=Yn(t,()=>n.matches);return St(n,"change",()=>r(n.matches)),s}function wi(e){return bi("(prefers-color-scheme: dark)",e)}var xi=ts(wi.bind(void 0,!1));const Si=w('<button id="theme-toggle" class="flex items-center justify-center w-10 h-10 rounded-md border transition-colors border-0 hover:animate-rubber-band"><svg width="20px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="dark:fill-transparent fill-black" fill-rule="evenodd" d="M12 17.5a5.5 5.5 0 1 0 0-11 5.5 5.5 0 0 0 0 11zm0 1.5a7 7 0 1 0 0-14 7 7 0 0 0 0 14zm12-7a.8.8 0 0 1-.8.8h-2.4a.8.8 0 0 1 0-1.6h2.4a.8.8 0 0 1 .8.8zM4 12a.8.8 0 0 1-.8.8H.8a.8.8 0 0 1 0-1.6h2.5a.8.8 0 0 1 .8.8zm16.5-8.5a.8.8 0 0 1 0 1l-1.8 1.8a.8.8 0 0 1-1-1l1.7-1.8a.8.8 0 0 1 1 0zM6.3 17.7a.8.8 0 0 1 0 1l-1.7 1.8a.8.8 0 1 1-1-1l1.7-1.8a.8.8 0 0 1 1 0zM12 0a.8.8 0 0 1 .8.8v2.5a.8.8 0 0 1-1.6 0V.8A.8.8 0 0 1 12 0zm0 20a.8.8 0 0 1 .8.8v2.4a.8.8 0 0 1-1.6 0v-2.4a.8.8 0 0 1 .8-.8zM3.5 3.5a.8.8 0 0 1 1 0l1.8 1.8a.8.8 0 1 1-1 1L3.5 4.6a.8.8 0 0 1 0-1zm14.2 14.2a.8.8 0 0 1 1 0l1.8 1.7a.8.8 0 0 1-1 1l-1.8-1.7a.8.8 0 0 1 0-1z"></path><path class="fill-transparent dark:fill-gray" fill-rule="evenodd" d="M16.5 6A10.5 10.5 0 0 1 4.7 16.4 8.5 8.5 0 1 0 16.4 4.7l.1 1.3zm-1.7-2a9 9 0 0 1 .2 2 9 9 0 0 1-11 8.8 9.4 9.4 0 0 1-.8-.3c-.4 0-.8.3-.7.7a10 10 0 0 0 .3.8 10 10 0 0 0 9.2 6 10 10 0 0 0 4-19.2 9.7 9.7 0 0 0-.9-.3c-.3-.1-.7.3-.6.7a9 9 0 0 1 .3.8z">');function vi(){const e=xi();function t(s){document.documentElement.classList.toggle("dark",s),document?.querySelector('meta[name="theme-color"]')?.setAttribute("content",s?"#16161a":"#f6f8fa")}M(()=>{!localStorage.getItem(re.THEME)&&t(e())});function n(){const s=document.documentElement;s.classList.toggle("dark");const r=s.classList.contains("dark");document?.querySelector('meta[name="theme-color"]')?.setAttribute("content",r?"#16161a":"#f6f8fa"),localStorage.setItem(re.THEME,r?"dark":"light")}return(()=>{const s=Si();return s.$$click=n,s})()}ce(["click"]);const $i=w('<div class="text-7em h-1em mb-8">'),_i=w('<div id="logo" class="pl-1em cursor-pointer inline-block">'),ki=w('<span class="ml-1 font-extrabold text-slate-7 dark:text-slate">'),Ei=w('<header class="px-4 py-2 sticky top-0 z-99 flex justify-between items-center"><div class="flex items-center text-2xl cursor-pointer">'),Li=w('<div class="w-8em h-8em">'),Ai=w('<span class="text-transparent font-extrabold bg-clip-text bg-gradient-to-r dark:from-yellow-300 from-yellow-600 dark:to-red-700 to-red-700 mr-1">ChatGPT'),Ti=w('<span class="ml-1 font-extrabold text-slate-7 dark:text-slate">Vercel'),Ii=w('<a class="ml-2 <sm:hidden" href="https://github.com/ourongxing/chatgpt-vercel"><img alt="GitHub forks badge" src="https://img.shields.io/github/stars/ourongxing/chatgpt-vercel?logo=github">'),Pi=w('<a class="ml-2" href="https://github.com/ourongxing/chatgpt-vercel/fork"><img alt="GitHub forks badge" src="https://img.shields.io/github/forks/ourongxing/chatgpt-vercel?logo=github">');function Mi(e){const[t,n]=e.split(/^([\u{1F300}-\u{1F64F}\u{1F680}-\u{1F6FF}\u{2600}-\u{26FF}\u{2700}-\u{27BF}\u{1F900}-\u{1F9FF}\u{1F1E0}-\u{1F1FF}])\s*(.+)$/u).filter(Boolean);return n?{icon:t,title:n}:{icon:void 0,title:t}}function Ri(e,t=0){const s=document.querySelector(e).getBoundingClientRect().top+window.pageYOffset+t;window.scrollTo({top:s,behavior:"smooth"})}function Oi(){const{store:e}=ue,t=xt(),n=D(()=>Mi(e.sessionSettings.title));return[(()=>{const s=_i();return s.$$click=()=>{t("/",{replace:!0}),Me("index")},y(s,p(P,{get when(){return n().icon},get fallback(){return(()=>{const r=Li();return r.innerHTML=yi,r})()},get children(){const r=$i();return y(r,()=>n().icon),r}})),s})(),(()=>{const s=Ei(),r=s.firstChild;return r.$$click=()=>{Ri("main",-48)},y(r,p(P,{get when(){return n().title},get fallback(){return[Ai(),Ti(),Ii(),Pi()]},get children(){const i=ki();return y(i,()=>n().title),i}})),y(s,p(vi,{}),null),s})()]}ce(["click"]);const Fi=w('<div id="root" class="sm:pt-8em py-2em before">');function Hi({children:e}){return(()=>{const t=Fi();return y(t,p(Oi,{}),null),y(t,e,null),t})()}export{Bi as C,Hi as L,ue as R,vt as g};
